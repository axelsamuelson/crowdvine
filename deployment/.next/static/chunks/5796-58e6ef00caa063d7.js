"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5796],{25796:(e,a,r)=>{r.d(a,{default:()=>O});var t=r(95155),s=r(12115),i=r(35695),n=r(97168),l=r(89852),c=r(82714),d=r(99474),o=r(95784),h=r(88482),p=r(49026),x=r(34477);let u=(0,x.createServerReference)("600d783cb3bc5d9bf756e6d6da6ee83de2ee57c3f9",x.callServer,void 0,x.findSourceMapURL,"updateWine"),m=(0,x.createServerReference)("40400762e92e9a18c27f749da35b9792097f301365",x.callServer,void 0,x.findSourceMapURL,"createWine");var g=r(29869),_=r(92657),f=r(38564),v=r(8804),j=r(54416);function y(e){let{wineId:a,existingImages:i=[],onImagesChange:l,onExistingImagesChange:c,images:d=[]}=e,[o,x]=(0,s.useState)(!1),[u,m]=(0,s.useState)(""),[y,b]=(0,s.useState)(!1),N=(0,s.useRef)(null),w=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?x(!0):"dragleave"===e.type&&x(!1)},S=e=>{l&&l(d.filter((a,r)=>r!==e))},C=(e,a)=>{if(l){let r=[...d],[t]=r.splice(e,1);r.splice(a,0,t),l(r)}},F=async e=>{if(a){b(!0);try{let{deleteWineImage:a}=await r.e(5898).then(r.bind(r,15898));if(await a(e),c){let a=i.filter(a=>a.id!==e);c(a)}}catch(e){m(e instanceof Error?e.message:"Failed to delete image")}finally{b(!1)}}},E=async e=>{if(a){b(!0);try{let{setPrimaryWineImage:a}=await r.e(5898).then(r.bind(r,15898));if(await a(e),c){let a=i.map(a=>({...a,is_primary:a.id===e}));c(a)}}catch(e){m(e instanceof Error?e.message:"Failed to set primary image")}finally{b(!1)}}},k=async e=>{if(a){b(!0);try{let{reorderWineImages:t}=await r.e(5898).then(r.bind(r,15898));if(await t(a,e),c){let a=e.map((e,a)=>{let r=i.find(a=>a.id===e);return r?{...r,sort_order:a}:null}).filter(Boolean);c(a)}}catch(e){m(e instanceof Error?e.message:"Failed to reorder images")}finally{b(!1)}}},R=(e,a)=>{let r=[...i],[t]=r.splice(e,1);r.splice(a,0,t),k(r.map(e=>e.id))},P=[...i,...d.map((e,r)=>({id:"new-".concat(r),wine_id:a||"",image_path:URL.createObjectURL(e),alt_text:e.name,sort_order:i.length+r,is_primary:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),isNew:!0}))];return(0,t.jsxs)(h.Zp,{children:[(0,t.jsxs)(h.aR,{children:[(0,t.jsx)(h.ZB,{children:"Product Images"}),(0,t.jsx)(h.BT,{children:"Upload multiple images for this wine. Drag and drop to reorder. The first image will be the main product image."})]}),(0,t.jsxs)(h.Wu,{className:"space-y-4",children:[u&&(0,t.jsx)(p.Fc,{variant:"destructive",children:(0,t.jsx)(p.TN,{children:u})}),(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(o?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400"),onDragEnter:w,onDragLeave:w,onDragOver:w,onDrop:e=>{e.preventDefault(),e.stopPropagation(),x(!1),m("");let a=Array.from(e.dataTransfer.files),r=a.filter(e=>e.type.startsWith("image/"));r.length!==a.length&&m("Some files are not images and were ignored"),r.length>0&&l&&l([...d,...r])},children:[(0,t.jsx)(g.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drop images here or click to upload"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Supports JPG, PNG, GIF up to 10MB each"}),(0,t.jsx)(n.$,{onClick:()=>{var e;null===(e=N.current)||void 0===e||e.click()},variant:"outline",type:"button",disabled:y,children:"Choose Files"}),(0,t.jsx)("input",{ref:N,type:"file",multiple:!0,accept:"image/*",onChange:e=>{let a=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));a.length>0&&l&&l([...d,...a])},className:"hidden"})]}),P.length>0&&(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-gray-900",children:["Images (",P.length,")"]}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:P.map((e,a)=>{let r="isNew"in e,s=!r;return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-lg border overflow-hidden bg-gray-100",children:(0,t.jsx)("img",{src:e.image_path,alt:e.alt_text||"Product image ".concat(a+1),className:"w-full h-full object-cover"})}),e.is_primary&&(0,t.jsx)("div",{className:"absolute top-1 left-1 bg-yellow-500 text-white text-xs px-1 py-0.5 rounded",children:"★"}),(0,t.jsx)("div",{className:"absolute top-1 right-1 bg-black/70 text-white text-xs px-1 py-0.5 rounded text-[10px]",children:a+1}),(0,t.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-1",children:[(0,t.jsx)(n.$,{size:"sm",variant:"secondary",type:"button",className:"h-6 w-6 p-0",onClick:()=>{let a=window.open(e.image_path);a&&a.focus()},children:(0,t.jsx)(_.A,{className:"h-3 w-3"})}),s&&(0,t.jsx)(n.$,{size:"sm",variant:"secondary",type:"button",className:"h-6 w-6 p-0",onClick:()=>E(e.id),disabled:y||e.is_primary,children:e.is_primary?(0,t.jsx)(f.A,{className:"h-3 w-3 text-yellow-500"}):(0,t.jsx)(v.A,{className:"h-3 w-3"})}),(0,t.jsx)(n.$,{size:"sm",variant:"destructive",type:"button",className:"h-6 w-6 p-0",onClick:()=>{r?S(a-i.length):F(e.id)},disabled:y,children:(0,t.jsx)(j.A,{className:"h-3 w-3"})})]}),(0,t.jsxs)("div",{className:"absolute bottom-1 left-1 space-y-1",children:[a>0&&(0,t.jsx)(n.$,{size:"sm",variant:"secondary",className:"h-4 w-4 p-0 text-xs",type:"button",onClick:()=>{s&&a<i.length?R(a,a-1):r&&C(a-i.length,a-i.length-1)},disabled:y,children:"↑"}),a<P.length-1&&(0,t.jsx)(n.$,{size:"sm",variant:"secondary",className:"h-4 w-4 p-0 text-xs",type:"button",onClick:()=>{s&&a<i.length-1?R(a,a+1):r&&C(a-i.length,a-i.length+1)},disabled:y,children:"↓"})]})]},e.id)})}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,t.jsx)("p",{children:"• First image will be the main product image (marked with ★)"}),(0,t.jsx)("p",{children:"• Drag and drop or use arrow buttons to reorder"}),(0,t.jsx)("p",{children:"• Click the eye icon to preview full size"}),(0,t.jsx)("p",{children:"• Click the star icon to set as primary image"})]})]})]})]})}var b=r(90088),N=r(88145),w=r(33109),S=r(69074),C=r(72713),F=r(6740),E=r(5937);function k(e){let{pricingData:a,onPricingChange:r}=e,[i,n]=(0,s.useState)(null),[d,p]=(0,s.useState)(!1),x=[{value:"current",label:"Current Rate",icon:w.A},{value:"static_date",label:"Static Date",icon:S.A},{value:"period_average",label:"Period Average",icon:C.A}],u=(e,t)=>{r({...a,[e]:t})},m=async e=>{if("SEK"!==e){p(!0);try{let a=await fetch("/api/exchange-rates?from=".concat(e,"&to=SEK")),r=await a.json();n(r.rate)}catch(e){console.error("Failed to fetch exchange rate:",e)}finally{p(!1)}}};(0,s.useEffect)(()=>{a.cost_currency&&"current"===a.exchange_rate_source&&m(a.cost_currency)},[a.cost_currency,a.exchange_rate_source]);let g=(()=>{let e=a.cost_amount*(i||a.exchange_rate||1),r=e*(1+a.margin_percentage/100),t=r+a.alcohol_tax_cents/100,s=a.price_includes_vat?t:1.25*t,n=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return Math.round(1.25*(e*a*1.147+r/100)*100)/100}(a.cost_amount,i||a.exchange_rate||1,a.alcohol_tax_cents),l=s-e;return{costInSek:e.toFixed(2),priceBeforeTax:r.toFixed(2),priceAfterTax:t.toFixed(2),finalPrice:s.toFixed(2),finalPriceCents:Math.ceil(100*s),sbPrice:n.toFixed(2),ourMarginSek:l.toFixed(2),priceDifference:(n-s).toFixed(2),priceDifferencePercent:((n-s)/s*100).toFixed(1)}})();return(0,t.jsxs)(h.Zp,{children:[(0,t.jsxs)(h.aR,{children:[(0,t.jsxs)(h.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(F.A,{className:"h-5 w-5"}),"Pricing Calculator"]}),(0,t.jsx)(h.BT,{children:"Configure cost, exchange rates, taxes, and margins to calculate final price"})]}),(0,t.jsxs)(h.Wu,{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"cost_currency",children:"Cost Currency"}),(0,t.jsxs)(o.l6,{value:a.cost_currency,onValueChange:e=>{u("cost_currency",e),"current"===a.exchange_rate_source&&m(e)},children:[(0,t.jsx)(o.bq,{children:(0,t.jsx)(o.yv,{})}),(0,t.jsx)(o.gC,{children:[{code:"EUR",name:"Euro (EUR)"},{code:"USD",name:"US Dollar (USD)"},{code:"GBP",name:"British Pound (GBP)"},{code:"SEK",name:"Swedish Krona (SEK)"}].map(e=>(0,t.jsx)(o.eb,{value:e.code,children:e.name},e.code))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"cost_amount",children:"Cost Amount"}),(0,t.jsx)(l.p,{id:"cost_amount",type:"number",step:"0.01",value:a.cost_amount,onChange:e=>u("cost_amount",parseFloat(e.target.value)||0),placeholder:"7.00"})]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)(c.J,{children:"Exchange Rate Source"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:x.map(e=>{let r=e.icon;return(0,t.jsxs)("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors ".concat(a.exchange_rate_source===e.value?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"),onClick:()=>u("exchange_rate_source",e.value),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(r,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"font-medium",children:e.label})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["current"===e.value&&"Use today's rate","static_date"===e.value&&"Use rate from specific date","period_average"===e.value&&"Use average over period"]})]},e.value)})}),"static_date"===a.exchange_rate_source&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"exchange_rate_date",children:"Exchange Rate Date"}),(0,t.jsx)(l.p,{id:"exchange_rate_date",type:"date",value:a.exchange_rate_date||"",onChange:e=>u("exchange_rate_date",e.target.value)})]}),"period_average"===a.exchange_rate_source&&(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"exchange_rate_period_start",children:"Period Start"}),(0,t.jsx)(l.p,{id:"exchange_rate_period_start",type:"date",value:a.exchange_rate_period_start||"",onChange:e=>u("exchange_rate_period_start",e.target.value)})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"exchange_rate_period_end",children:"Period End"}),(0,t.jsx)(l.p,{id:"exchange_rate_period_end",type:"date",value:a.exchange_rate_period_end||"",onChange:e=>u("exchange_rate_period_end",e.target.value)})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"exchange_rate",children:"Manual Exchange Rate (optional)"}),(0,t.jsx)(l.p,{id:"exchange_rate",type:"number",step:"0.000001",value:a.exchange_rate||"",onChange:e=>u("exchange_rate",parseFloat(e.target.value)||void 0),placeholder:"11.25"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"alcohol_tax_cents",children:"Alcohol Tax (SEK)"}),(0,t.jsx)(l.p,{id:"alcohol_tax_cents",type:"number",step:"0.01",value:(a.alcohol_tax_cents/100).toFixed(2),onChange:e=>u("alcohol_tax_cents",Math.round(100*parseFloat(e.target.value))||0),placeholder:"2.20"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"margin_percentage",children:"Margin (%)"}),(0,t.jsx)(l.p,{id:"margin_percentage",type:"number",step:"0.01",value:a.margin_percentage,onChange:e=>u("margin_percentage",parseFloat(e.target.value)||0),placeholder:"30.00"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"price_includes_vat",children:"Price Includes VAT"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(b.d,{id:"price_includes_vat",checked:a.price_includes_vat,onCheckedChange:e=>u("price_includes_vat",e)}),(0,t.jsx)(c.J,{htmlFor:"price_includes_vat",className:"text-sm",children:a.price_includes_vat?"Including VAT":"Excluding VAT"})]})]})]}),(0,t.jsxs)(h.Zp,{className:"bg-gray-50",children:[(0,t.jsx)(h.aR,{children:(0,t.jsx)(h.ZB,{className:"text-lg",children:"Price Breakdown"})}),(0,t.jsxs)(h.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Cost in SEK:"}),(0,t.jsxs)("span",{className:"font-medium",children:[g.costInSek," SEK"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Price before tax:"}),(0,t.jsxs)("span",{className:"font-medium",children:[g.priceBeforeTax," SEK"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Price after alcohol tax:"}),(0,t.jsxs)("span",{className:"font-medium",children:[g.priceAfterTax," SEK"]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,t.jsx)("span",{children:"Final Price:"}),(0,t.jsxs)(N.E,{variant:"default",className:"text-lg",children:[g.finalPrice," SEK"]})]})]})]}),(0,t.jsxs)(h.Zp,{className:"bg-blue-50",children:[(0,t.jsxs)(h.aR,{children:[(0,t.jsxs)(h.ZB,{className:"text-lg flex items-center gap-2",children:[(0,t.jsx)(E.A,{className:"h-5 w-5"}),"Systembolaget Comparison"]}),(0,t.jsx)(h.BT,{children:"Compare your pricing with Systembolaget's pricing (14.7% margin)"})]}),(0,t.jsxs)(h.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Your Price:"}),(0,t.jsxs)(N.E,{variant:"default",className:"text-lg",children:[g.finalPrice," SEK"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Your Margin:"}),(0,t.jsxs)("span",{className:"font-medium text-blue-600",children:[g.ourMarginSek," SEK (",a.margin_percentage,"%)"]})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Systembolaget Price:"}),(0,t.jsxs)(N.E,{variant:"outline",className:"text-lg",children:[g.sbPrice," SEK"]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Price Difference:"}),(0,t.jsxs)("span",{className:"font-medium ".concat(parseFloat(g.priceDifference)>0?"text-red-600":"text-green-600"),children:[parseFloat(g.priceDifference)>0?"+":"",g.priceDifference," SEK (",g.priceDifferencePercent,"%)"]})]})]})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 bg-white p-3 rounded border",children:[(0,t.jsx)("strong",{children:"Competitive Analysis:"})," ",parseFloat(g.priceDifference)>0?"Systembolaget is ".concat(g.priceDifference," SEK (").concat(g.priceDifferencePercent,"%) more expensive than your price."):0>parseFloat(g.priceDifference)?"You are ".concat(Math.abs(parseFloat(g.priceDifference))," SEK (").concat(Math.abs(parseFloat(g.priceDifferencePercent)),"%) more expensive than Systembolaget."):"Your price matches Systembolaget exactly."]})]})]}),i&&"current"===a.exchange_rate_source&&(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:["Current exchange rate: 1 ",a.cost_currency," ="," ",i.toFixed(4)," SEK"]})]})]})}var R=r(77740),P=r(47924),D=r(53999);r(99840);let A=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(R.uB,{ref:a,className:(0,D.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",r),...s})});A.displayName=R.uB.displayName;let B=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,t.jsx)(P.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,t.jsx)(R.uB.Input,{ref:a,className:(0,D.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",r),...s})]})});B.displayName=R.uB.Input.displayName;let T=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(R.uB.List,{ref:a,className:(0,D.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",r),...s})});T.displayName=R.uB.List.displayName;let J=s.forwardRef((e,a)=>(0,t.jsx)(R.uB.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));J.displayName=R.uB.Empty.displayName;let L=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(R.uB.Group,{ref:a,className:(0,D.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",r),...s})});L.displayName=R.uB.Group.displayName,s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(R.uB.Separator,{ref:a,className:(0,D.cn)("-mx-1 h-px bg-border",r),...s})}).displayName=R.uB.Separator.displayName;let U=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)(R.uB.Item,{ref:a,className:(0,D.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",r),...s})});U.displayName=R.uB.Item.displayName;var M=r(80343);let K=M.bL,I=M.l9,V=s.forwardRef((e,a)=>{let{className:r,align:s="center",sideOffset:i=4,...n}=e;return(0,t.jsx)(M.ZL,{children:(0,t.jsx)(M.UC,{ref:a,align:s,sideOffset:i,className:(0,D.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",r),...n})})});V.displayName=M.UC.displayName;var W=r(10081),z=r(84616),Z=r(5196);function $(e){let{selectedVarieties:a,onVarietiesChange:r,availableVarieties:i,onAddNewVariety:l,disabled:d=!1}=e,[o,h]=(0,s.useState)(!1),[p,x]=(0,s.useState)(""),[u,m]=(0,s.useState)(!1),g=e=>{a.includes(e)||r([...a,e]),x(""),h(!1)},_=e=>{r(a.filter(a=>a!==e))},f=async()=>{if(p.trim()&&l){m(!0);try{await l(p.trim()),x(""),h(!1)}catch(e){console.error("Failed to add new grape variety:",e)}finally{m(!1)}}},v=i.filter(e=>e.name.toLowerCase().includes(p.toLowerCase())&&!a.includes(e.id)),y=i.filter(e=>a.includes(e.id));return(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(c.J,{children:"Grape Varieties"}),y.length>0&&(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:y.map(e=>(0,t.jsxs)(N.E,{variant:"secondary",className:"flex items-center gap-1 px-3 py-1",children:[(0,t.jsx)("span",{children:e.name}),(0,t.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 ml-1 hover:bg-transparent",onClick:()=>_(e.id),disabled:d,children:(0,t.jsx)(j.A,{className:"h-3 w-3"})})]},e.id))}),(0,t.jsxs)(K,{open:o,onOpenChange:h,children:[(0,t.jsx)(I,{asChild:!0,children:(0,t.jsxs)(n.$,{variant:"outline",role:"combobox","aria-expanded":o,className:"w-full justify-between",disabled:d,children:[p||"Select grape varieties...",(0,t.jsx)(W.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,t.jsx)(V,{className:"w-full p-0",align:"start",children:(0,t.jsxs)(A,{children:[(0,t.jsx)(B,{placeholder:"Search grape varieties...",value:p,onValueChange:x}),(0,t.jsxs)(T,{children:[(0,t.jsxs)(J,{children:[p&&l&&(0,t.jsx)("div",{className:"p-2",children:(0,t.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",className:"w-full justify-start",onClick:f,disabled:u,children:[(0,t.jsx)(z.A,{className:"mr-2 h-4 w-4"}),'Add "',p,'"']})}),!p&&"No grape varieties found."]}),(0,t.jsx)(L,{children:v.map(e=>(0,t.jsxs)(U,{value:e.name,onSelect:()=>g(e.id),children:[(0,t.jsx)(Z.A,{className:(0,D.cn)("mr-2 h-4 w-4",a.includes(e.id)?"opacity-100":"opacity-0")}),e.name,e.description&&(0,t.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",e.description,")"]})]},e.id))})]})]})})]})]})}let G=(0,x.createServerReference)("002e021e0c56020e41a2211cff29c17a9c0993cd50",x.callServer,void 0,x.findSourceMapURL,"getGrapeVarieties"),q=(0,x.createServerReference)("4083e03483d950816b52d4cec2f64186bd163cf2fe",x.callServer,void 0,x.findSourceMapURL,"createGrapeVariety");function O(e){var a;let{wine:x,producers:g}=e,[_,f]=(0,s.useState)({handle:(null==x?void 0:x.handle)||"",wine_name:(null==x?void 0:x.wine_name)||"",vintage:(null==x?void 0:x.vintage)||"",grape_varieties:(null==x?void 0:x.grape_varieties)||"",color:(null==x?void 0:x.color)||"red",producer_id:(null==x?void 0:x.producer_id)||"",cost_currency:(null==x?void 0:x.cost_currency)||"EUR",cost_amount:(null==x?void 0:x.cost_amount)||0,exchange_rate_source:(null==x?void 0:x.exchange_rate_source)||"current",exchange_rate_date:(null==x?void 0:x.exchange_rate_date)||void 0,exchange_rate_period_start:(null==x?void 0:x.exchange_rate_period_start)||void 0,exchange_rate_period_end:(null==x?void 0:x.exchange_rate_period_end)||void 0,exchange_rate:(null==x?void 0:x.exchange_rate)||void 0,alcohol_tax_cents:(null==x?void 0:x.alcohol_tax_cents)||0,price_includes_vat:null===(a=null==x?void 0:x.price_includes_vat)||void 0===a||a,margin_percentage:(null==x?void 0:x.margin_percentage)||30,base_price_cents:(null==x?void 0:x.base_price_cents)||0,label_image_path:(null==x?void 0:x.label_image_path)||"",description:(null==x?void 0:x.description)||"",description_html:(null==x?void 0:x.description_html)||""}),[v,j]=(0,s.useState)([]),[b,N]=(0,s.useState)([]),[w,S]=(0,s.useState)(""),[C,F]=(0,s.useState)(!1),[E,R]=(0,s.useState)([]),[P,D]=(0,s.useState)([]),A=(0,i.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let e=await G();R(e)}catch(e){console.error("Failed to load grape varieties:",e)}})()},[]),(0,s.useEffect)(()=>{let e=async()=>{if(x&&x.id)try{let{getWineGrapeVarieties:e}=await r.e(5141).then(r.bind(r,55141)),a=await e(x.id);D(a)}catch(e){console.error("Failed to load existing grape varieties:",e)}};x&&E.length>0&&e()},[x,E]),(0,s.useEffect)(()=>{let e=async()=>{if(x&&x.id)try{let{getWineImages:e}=await r.e(5898).then(r.bind(r,15898)),a=await e(x.id);N(a)}catch(e){console.error("Failed to load existing images:",e)}};x&&e()},[x]);let B=e=>{D(e);let a=E.filter(a=>e.includes(a.id)).map(e=>e.name).join(", ");f(e=>({...e,grape_varieties:a}))},T=async e=>{try{let a=await q({name:e,description:""});R(e=>[...e,a]),B([...P,a.id])}catch(e){throw console.error("Failed to create grape variety:",e),e}},J=async e=>{e.preventDefault(),F(!0),S("");let a=[];if(_.wine_name.trim()||a.push("Wine Name"),_.handle.trim()||a.push("Handle"),_.vintage.trim()||a.push("Vintage"),_.producer_id||a.push("Producer"),a.length>0){S("Please fill in the following required fields: ".concat(a.join(", "))),F(!1);return}try{let e,a=[];if(v.length>0){let e=new FormData;v.forEach(a=>{e.append("files",a)});let r=await fetch("/api/upload",{method:"POST",body:e});if(!r.ok)throw Error("Failed to upload images");a=(await r.json()).files}let t={..._,label_image_path:a.length>0?a[0]:_.label_image_path};if((e=x?await u(x.id,t):await m(t))&&a.length>0){let{createWineImage:t}=await r.e(5898).then(r.bind(r,15898));for(let r=0;r<a.length;r++)await t({wine_id:e.id,image_path:a[r],alt_text:"".concat(e.wine_name," ").concat(e.vintage),sort_order:b.length+r,is_primary:0===r&&0===b.length})}if(e&&P.length>0){let{updateWineGrapeVarieties:a}=await r.e(5141).then(r.bind(r,55141));await a(e.id,P)}A.push("/admin/wines")}catch(e){console.error("Wine creation error:",e),e instanceof Error?S("Failed to save wine: ".concat(e.message)):S("An unexpected error occurred while saving the wine")}finally{F(!1)}},L=(e,a)=>{f(r=>({...r,[e]:a}))};return(0,t.jsxs)(h.Zp,{children:[(0,t.jsxs)(h.aR,{children:[(0,t.jsx)(h.ZB,{children:x?"Edit Wine":"Add Wine"}),(0,t.jsx)(h.BT,{children:x?"Update wine information":"Create a new wine product"})]}),(0,t.jsx)(h.Wu,{children:(0,t.jsxs)("form",{onSubmit:J,className:"space-y-6",children:[w&&(0,t.jsx)(p.Fc,{variant:"destructive",children:(0,t.jsx)(p.TN,{children:w})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"wine_name",children:"Wine Name *"}),(0,t.jsx)(l.p,{id:"wine_name",value:_.wine_name,onChange:e=>L("wine_name",e.target.value),required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"vintage",children:"Vintage *"}),(0,t.jsx)(l.p,{id:"vintage",value:_.vintage,onChange:e=>L("vintage",e.target.value),placeholder:"2020",required:!0})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"handle",children:"Handle *"}),(0,t.jsx)(l.p,{id:"handle",value:_.handle,onChange:e=>L("handle",e.target.value),placeholder:"wine-name-vintage",required:!0})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"color",children:"Color *"}),(0,t.jsxs)(o.l6,{value:_.color,onValueChange:e=>L("color",e),children:[(0,t.jsx)(o.bq,{children:(0,t.jsx)(o.yv,{})}),(0,t.jsxs)(o.gC,{children:[(0,t.jsx)(o.eb,{value:"red",children:"Red"}),(0,t.jsx)(o.eb,{value:"white",children:"White"}),(0,t.jsx)(o.eb,{value:"rose",children:"Ros\xe9"})]})]})]})]}),(0,t.jsx)($,{selectedVarieties:P,onVarietiesChange:B,availableVarieties:E,onAddNewVariety:T,disabled:C}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"producer_id",children:"Producer *"}),(0,t.jsxs)(o.l6,{value:_.producer_id,onValueChange:e=>L("producer_id",e),required:!0,children:[(0,t.jsx)(o.bq,{children:(0,t.jsx)(o.yv,{placeholder:"Select a producer"})}),(0,t.jsx)(o.gC,{children:g.map(e=>(0,t.jsxs)(o.eb,{value:e.id,children:[e.name," (",e.region,")"]},e.id))})]})]})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"description",children:"Description"}),(0,t.jsx)(d.T,{id:"description",value:_.description,onChange:e=>L("description",e.target.value),placeholder:"Enter a custom description for this wine...",rows:3}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Leave empty to use auto-generated description based on wine properties."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(c.J,{htmlFor:"description_html",children:"Description HTML"}),(0,t.jsx)(d.T,{id:"description_html",value:_.description_html,onChange:e=>L("description_html",e.target.value),placeholder:"Enter custom HTML description (optional)...",rows:4}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Custom HTML for rich formatting. Leave empty to use auto-generated HTML from description."})]})]}),(0,t.jsx)(k,{pricingData:{cost_currency:_.cost_currency,cost_amount:_.cost_amount,exchange_rate_source:_.exchange_rate_source,exchange_rate_date:_.exchange_rate_date,exchange_rate_period_start:_.exchange_rate_period_start,exchange_rate_period_end:_.exchange_rate_period_end,exchange_rate:_.exchange_rate,alcohol_tax_cents:_.alcohol_tax_cents,price_includes_vat:_.price_includes_vat,margin_percentage:_.margin_percentage,calculated_price_cents:0},onPricingChange:e=>{f(a=>({...a,cost_currency:e.cost_currency,cost_amount:e.cost_amount,exchange_rate_source:e.exchange_rate_source,exchange_rate_date:e.exchange_rate_date,exchange_rate_period_start:e.exchange_rate_period_start,exchange_rate_period_end:e.exchange_rate_period_end,exchange_rate:e.exchange_rate,alcohol_tax_cents:e.alcohol_tax_cents,price_includes_vat:e.price_includes_vat,margin_percentage:e.margin_percentage,base_price_cents:e.finalPriceCents}))}}),(0,t.jsx)(y,{wineId:null==x?void 0:x.id,existingImages:b,images:v,onImagesChange:j,onExistingImagesChange:N}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,t.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>A.back(),children:"Cancel"}),(0,t.jsx)(n.$,{type:"submit",disabled:C,children:C?"Saving...":x?"Update Wine":"Create Wine"})]})]})})]})}},49026:(e,a,r)=>{r.d(a,{Fc:()=>c,TN:()=>o,XL:()=>d,ju:()=>l});var t=r(95155),s=r(12115),i=r(74466),n=r(53999);let l=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-card text-foreground",destructive:"border-destructive/50 bg-card text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 bg-green-50 text-green-700 dark:border-green-500 dark:bg-green-950 dark:text-green-300 [&>svg]:text-green-600 dark:[&>svg]:text-green-400"}},defaultVariants:{variant:"default"}}),c=s.forwardRef((e,a)=>{let{className:r,variant:s,...i}=e;return(0,t.jsx)("div",{ref:a,role:"alert",className:(0,n.cn)(l({variant:s}),r),...i})});c.displayName="Alert";let d=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("h5",{ref:a,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",r),...s})});d.displayName="AlertTitle";let o=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("div",{ref:a,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",r),...s})});o.displayName="AlertDescription"},99474:(e,a,r)=>{r.d(a,{T:()=>n});var t=r(95155),s=r(12115),i=r(53999);let n=s.forwardRef((e,a)=>{let{className:r,...s}=e;return(0,t.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:a,...s})});n.displayName="Textarea"}}]);