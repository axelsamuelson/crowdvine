(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6636],{18591:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>A});var r=a(95155),t=a(12115),l=a(88482),i=a(97168),n=a(89852),d=a(82714),o=a(88145),c=a(72526),m=a(71007),h=a(4229),u=a(54416),x=a(28883),p=a(19420),f=a(4516),j=a(69074),g=a(13717),y=a(81586),N=a(84616),v=a(381),b=a(37108),w=a(6874),_=a.n(w),E=a(56671);function A(){let[e,s]=(0,t.useState)(null),[a,w]=(0,t.useState)([]),[A,k]=(0,t.useState)(!0),[C,F]=(0,t.useState)(!1),[P,S]=(0,t.useState)({full_name:"",phone:"",address:"",city:"",postal_code:"",country:"Sweden"});(0,t.useEffect)(()=>{$(),J()},[]);let $=async()=>{try{let e=await fetch("/api/user/profile");if(!e.ok)throw Error("Failed to fetch profile");let a=await e.json();s(a),S({full_name:a.full_name||"",phone:a.phone||"",address:a.address||"",city:a.city||"",postal_code:a.postal_code||"",country:a.country||"Sweden"}),k(!1)}catch(e){console.error("Error fetching profile:",e),E.o.error("Failed to fetch profile"),k(!1)}},J=async()=>{try{let e=await fetch("/api/user/payment-methods");if(!e.ok)throw Error("Failed to fetch payment methods");let s=await e.json();w(s)}catch(e){console.error("Error fetching payment methods:",e)}},M=async()=>{try{let e=await fetch("/api/user/profile",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(P)});if(!e.ok)throw Error("Failed to update profile");let a=await e.json();s(a),F(!1),E.o.success("Profile updated successfully")}catch(e){console.error("Error updating profile:",e),E.o.error("Failed to update profile")}},R=async()=>{try{let e=await fetch("/api/user/profile");if(!e.ok){E.o.error("Please add your profile information first");return}let s=await e.json();if(!s.email){E.o.error("Email is required to add payment method");return}let a=await fetch("/api/checkout/setup?email=".concat(encodeURIComponent(s.email),"&name=").concat(encodeURIComponent(s.full_name||"")));if(!a.ok){let e=await a.json();E.o.error(e.error||"Failed to setup payment method");return}let r=await a.json();r.url?window.location.href=r.url:E.o.error("Failed to setup payment method")}catch(e){console.error("Error adding payment method:",e),E.o.error("Failed to add payment method")}},D=async e=>{try{if(!(await fetch("/api/user/payment-methods/".concat(e,"/set-default"),{method:"PATCH"})).ok)throw Error("Failed to set default payment method");w(s=>s.map(s=>({...s,is_default:s.id===e}))),E.o.success("Default payment method updated")}catch(e){console.error("Error setting default payment method:",e),E.o.error("Failed to update default payment method")}},Z=async e=>{try{if(!(await fetch("/api/user/payment-methods/".concat(e),{method:"DELETE"})).ok)throw Error("Failed to delete payment method");w(s=>s.filter(s=>s.id!==e)),E.o.success("Payment method deleted")}catch(e){console.error("Error deleting payment method:",e),E.o.error("Failed to delete payment method")}};return A?(0,r.jsx)(c.M,{children:(0,r.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading profile..."})]})})}):(0,r.jsx)(c.M,{className:"pt-8",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto flex items-center justify-center",children:(0,r.jsx)(m.A,{className:"w-12 h-12 text-white"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900",children:"My Profile"}),(0,r.jsx)("p",{className:"text-gray-600 mt-2 text-lg",children:"Manage your account information and preferences"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,r.jsxs)(l.Zp,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:[(0,r.jsx)(l.aR,{className:"pb-4",children:(0,r.jsxs)(l.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(m.A,{className:"w-5 h-5 text-blue-600"})}),"Personal Information"]})}),(0,r.jsx)(l.Wu,{className:"space-y-4",children:C?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.J,{htmlFor:"full_name",children:"Full Name"}),(0,r.jsx)(n.p,{id:"full_name",value:P.full_name,onChange:e=>S({...P,full_name:e.target.value}),placeholder:"Enter your full name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.J,{htmlFor:"phone",children:"Phone Number"}),(0,r.jsx)(n.p,{id:"phone",value:P.phone,onChange:e=>S({...P,phone:e.target.value}),placeholder:"Enter your phone number"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.J,{htmlFor:"address",children:"Address"}),(0,r.jsx)(n.p,{id:"address",value:P.address,onChange:e=>S({...P,address:e.target.value}),placeholder:"Enter your address"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(d.J,{htmlFor:"city",children:"City"}),(0,r.jsx)(n.p,{id:"city",value:P.city,onChange:e=>S({...P,city:e.target.value}),placeholder:"Enter your city"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.J,{htmlFor:"postal_code",children:"Postal Code"}),(0,r.jsx)(n.p,{id:"postal_code",value:P.postal_code,onChange:e=>S({...P,postal_code:e.target.value}),placeholder:"Enter postal code"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.J,{htmlFor:"country",children:"Country"}),(0,r.jsx)(n.p,{id:"country",value:P.country,onChange:e=>S({...P,country:e.target.value}),placeholder:"Enter your country"})]}),(0,r.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,r.jsxs)(i.$,{onClick:M,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700",children:[(0,r.jsx)(h.A,{className:"w-4 h-4 mr-2"}),"Save Changes"]}),(0,r.jsxs)(i.$,{variant:"outline",onClick:()=>F(!1),className:"flex-1 border-gray-300 hover:bg-gray-50",children:[(0,r.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(x.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Email"}),(0,r.jsx)("p",{className:"font-medium",children:null==e?void 0:e.email})]})]}),(null==e?void 0:e.full_name)&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(m.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Full Name"}),(0,r.jsx)("p",{className:"font-medium",children:e.full_name})]})]}),(null==e?void 0:e.phone)&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(p.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Phone"}),(0,r.jsx)("p",{className:"font-medium",children:e.phone})]})]}),((null==e?void 0:e.address)||(null==e?void 0:e.city))&&(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(f.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Address"}),(0,r.jsx)("p",{className:"font-medium",children:[e.address,e.city,e.postal_code,e.country].filter(Boolean).join(", ")})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(j.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-600",children:"Member Since"}),(0,r.jsx)("p",{className:"font-medium",children:(null==e?void 0:e.created_at)?new Date(e.created_at).toLocaleDateString():"N/A"})]})]}),(0,r.jsxs)(i.$,{onClick:()=>F(!0),className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 mt-6",children:[(0,r.jsx)(g.A,{className:"w-4 h-4 mr-2"}),"Edit Profile"]})]})})]}),(0,r.jsxs)(l.Zp,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:[(0,r.jsx)(l.aR,{className:"pb-4",children:(0,r.jsxs)(l.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(y.A,{className:"w-5 h-5 text-green-600"})}),"Payment Methods"]})}),(0,r.jsx)(l.Wu,{className:"space-y-4",children:0===a.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)(y.A,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"No payment methods added yet"}),(0,r.jsxs)(i.$,{onClick:R,children:[(0,r.jsx)(N.A,{className:"w-4 h-4 mr-2"}),"Add Payment Method"]})]}):(0,r.jsxs)("div",{className:"space-y-3",children:[a.map(e=>{var s;return(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(y.A,{className:"w-4 h-4 text-gray-500"}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("p",{className:"font-medium",children:[null===(s=e.brand)||void 0===s?void 0:s.toUpperCase()," •••• ",e.last4]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Expires ",e.expiry_month,"/",e.expiry_year]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[e.is_default&&(0,r.jsx)(o.E,{variant:"default",className:"bg-green-600",children:"Default"}),!e.is_default&&(0,r.jsx)(i.$,{size:"sm",variant:"outline",onClick:()=>D(e.id),children:"Set Default"}),(0,r.jsx)(i.$,{size:"sm",variant:"outline",onClick:()=>Z(e.id),children:(0,r.jsx)(u.A,{className:"w-4 h-4"})})]})]},e.id)}),(0,r.jsxs)(i.$,{onClick:R,className:"w-full",variant:"outline",children:[(0,r.jsx)(N.A,{className:"w-4 h-4 mr-2"}),"Add Another Payment Method"]})]})})]})]}),(0,r.jsxs)(l.Zp,{className:"border-0 shadow-lg bg-white/80 backdrop-blur-sm",children:[(0,r.jsx)(l.aR,{className:"pb-4",children:(0,r.jsxs)(l.ZB,{className:"flex items-center gap-3 text-xl",children:[(0,r.jsx)("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(v.A,{className:"w-5 h-5 text-purple-600"})}),"Quick Actions"]})}),(0,r.jsx)(l.Wu,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsx)(_(),{href:"/profile/reservations",children:(0,r.jsxs)(i.$,{variant:"outline",className:"w-full h-24 flex flex-col gap-3 hover:bg-blue-50 hover:border-blue-200 transition-all duration-200",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(b.A,{className:"w-6 h-6 text-blue-600"})}),(0,r.jsx)("span",{className:"font-medium",children:"View Reservations"})]})}),(0,r.jsx)(_(),{href:"/shop",children:(0,r.jsxs)(i.$,{variant:"outline",className:"w-full h-24 flex flex-col gap-3 hover:bg-green-50 hover:border-green-200 transition-all duration-200",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:(0,r.jsx)(b.A,{className:"w-6 h-6 text-green-600"})}),(0,r.jsx)("span",{className:"font-medium",children:"Browse Wines"})]})})]})})]})]})})}},39194:(e,s,a)=>{Promise.resolve().then(a.bind(a,18591))},82714:(e,s,a)=>{"use strict";a.d(s,{J:()=>o});var r=a(95155),t=a(12115),l=a(72797),i=a(74466),n=a(53999);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=t.forwardRef((e,s)=>{let{className:a,...t}=e;return(0,r.jsx)(l.b,{ref:s,className:(0,n.cn)(d(),a),...t})});o.displayName=l.b.displayName},89852:(e,s,a)=>{"use strict";a.d(s,{j:()=>i,p:()=>n});var r=a(95155),t=a(12115),l=a(53999);let i=(0,a(74466).F)("flex w-full rounded-full transition-[background-color,box-shadow] backdrop-blur-sm duration-200 ease-out bg-primary/20 shadow-sm ring-1 ring-transparent focus-visible:bg-primary/20 focus-visible:ring-1 focus-visible:ring-primary/40 focus-visible:ring-offset-4 focus-visible:ring-offset-black/10 disabled:cursor-not-allowed disabled:opacity-50 md:text-base text-white border-2 border-white/50 h-11 !text-base placeholder:text-white/80 focus:outline-none px-4"),n=t.forwardRef((e,s)=>{let{className:a,type:t,...i}=e;return(0,r.jsx)("input",{type:t,className:(0,l.cn)("flex h-10 w-full rounded-md border border-input bg-white px-3 py-1 text-base transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","aria-[invalid=true]:border-red-500 aria-[invalid=true]:focus-visible:!ring-red-500",a),ref:s,...i})});n.displayName="Input"}},e=>{var s=s=>e(e.s=s);e.O(0,[4277,6874,6671,2515,7678,8441,1684,7358],()=>s(39194)),_N_E=e.O()}]);