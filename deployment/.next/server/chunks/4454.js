"use strict";exports.id=4454,exports.ids=[4454],exports.modules={552:(e,a,t)=>{t.d(a,{default:()=>Z});var r=t(60687),s=t(43210),i=t(16189),n=t(24934),l=t(68988),d=t(39390),c=t(15616),o=t(63974),m=t(55192),u=t(3018),p=t(6475);let g=(0,p.createServerReference)("600d783cb3bc5d9bf756e6d6da6ee83de2ee57c3f9",p.callServer,void 0,p.findSourceMapURL,"updateWine"),f=(0,p.createServerReference)("40400762e92e9a18c27f749da35b9792097f301365",p.callServer,void 0,p.findSourceMapURL,"createWine");var h=t(16023),x=t(13861),v=t(64398),w=t(46806),_=t(11860);function b({wineId:e,existingImages:a=[],onImagesChange:i,onExistingImagesChange:l,images:d=[]}){let[c,o]=(0,s.useState)(!1),[p,g]=(0,s.useState)(""),[f,b]=(0,s.useState)(!1),y=(0,s.useRef)(null),j=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?o(!0):"dragleave"===e.type&&o(!1)},N=e=>{i&&i(d.filter((a,t)=>t!==e))},S=(e,a)=>{if(i){let t=[...d],[r]=t.splice(e,1);t.splice(a,0,r),i(t)}},C=async r=>{if(e){b(!0);try{let{deleteWineImage:e}=await t.e(6529).then(t.bind(t,46529));if(await e(r),l){let e=a.filter(e=>e.id!==r);l(e)}}catch(e){g(e instanceof Error?e.message:"Failed to delete image")}finally{b(!1)}}},E=async r=>{if(e){b(!0);try{let{setPrimaryWineImage:e}=await t.e(6529).then(t.bind(t,46529));if(await e(r),l){let e=a.map(e=>({...e,is_primary:e.id===r}));l(e)}}catch(e){g(e instanceof Error?e.message:"Failed to set primary image")}finally{b(!1)}}},k=async r=>{if(e){b(!0);try{let{reorderWineImages:s}=await t.e(6529).then(t.bind(t,46529));if(await s(e,r),l){let e=r.map((e,t)=>{let r=a.find(a=>a.id===e);return r?{...r,sort_order:t}:null}).filter(Boolean);l(e)}}catch(e){g(e instanceof Error?e.message:"Failed to reorder images")}finally{b(!1)}}},A=(e,t)=>{let r=[...a],[s]=r.splice(e,1);r.splice(t,0,s),k(r.map(e=>e.id))},P=[...a,...d.map((t,r)=>({id:`new-${r}`,wine_id:e||"",image_path:URL.createObjectURL(t),alt_text:t.name,sort_order:a.length+r,is_primary:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),isNew:!0}))];return(0,r.jsxs)(m.Zp,{children:[(0,r.jsxs)(m.aR,{children:[(0,r.jsx)(m.ZB,{children:"Product Images"}),(0,r.jsx)(m.BT,{children:"Upload multiple images for this wine. Drag and drop to reorder. The first image will be the main product image."})]}),(0,r.jsxs)(m.Wu,{className:"space-y-4",children:[p&&(0,r.jsx)(u.Fc,{variant:"destructive",children:(0,r.jsx)(u.TN,{children:p})}),(0,r.jsxs)("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${c?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400"}`,onDragEnter:j,onDragLeave:j,onDragOver:j,onDrop:e=>{e.preventDefault(),e.stopPropagation(),o(!1),g("");let a=Array.from(e.dataTransfer.files),t=a.filter(e=>e.type.startsWith("image/"));t.length!==a.length&&g("Some files are not images and were ignored"),t.length>0&&i&&i([...d,...t])},children:[(0,r.jsx)(h.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,r.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drop images here or click to upload"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Supports JPG, PNG, GIF up to 10MB each"}),(0,r.jsx)(n.$,{onClick:()=>{y.current?.click()},variant:"outline",type:"button",disabled:f,children:"Choose Files"}),(0,r.jsx)("input",{ref:y,type:"file",multiple:!0,accept:"image/*",onChange:e=>{let a=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));a.length>0&&i&&i([...d,...a])},className:"hidden"})]}),P.length>0&&(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h3",{className:"text-sm font-medium text-gray-900",children:["Images (",P.length,")"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:P.map((e,t)=>{let s="isNew"in e,i=!s;return(0,r.jsxs)("div",{className:"relative group",children:[(0,r.jsx)("div",{className:"w-20 h-20 rounded-lg border overflow-hidden bg-gray-100",children:(0,r.jsx)("img",{src:e.image_path,alt:e.alt_text||`Product image ${t+1}`,className:"w-full h-full object-cover"})}),e.is_primary&&(0,r.jsx)("div",{className:"absolute top-1 left-1 bg-yellow-500 text-white text-xs px-1 py-0.5 rounded",children:"★"}),(0,r.jsx)("div",{className:"absolute top-1 right-1 bg-black/70 text-white text-xs px-1 py-0.5 rounded text-[10px]",children:t+1}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-1",children:[(0,r.jsx)(n.$,{size:"sm",variant:"secondary",type:"button",className:"h-6 w-6 p-0",onClick:()=>{let a=window.open(e.image_path);a&&a.focus()},children:(0,r.jsx)(x.A,{className:"h-3 w-3"})}),i&&(0,r.jsx)(n.$,{size:"sm",variant:"secondary",type:"button",className:"h-6 w-6 p-0",onClick:()=>E(e.id),disabled:f||e.is_primary,children:e.is_primary?(0,r.jsx)(v.A,{className:"h-3 w-3 text-yellow-500"}):(0,r.jsx)(w.A,{className:"h-3 w-3"})}),(0,r.jsx)(n.$,{size:"sm",variant:"destructive",type:"button",className:"h-6 w-6 p-0",onClick:()=>{s?N(t-a.length):C(e.id)},disabled:f,children:(0,r.jsx)(_.A,{className:"h-3 w-3"})})]}),(0,r.jsxs)("div",{className:"absolute bottom-1 left-1 space-y-1",children:[t>0&&(0,r.jsx)(n.$,{size:"sm",variant:"secondary",className:"h-4 w-4 p-0 text-xs",type:"button",onClick:()=>{i&&t<a.length?A(t,t-1):s&&S(t-a.length,t-a.length-1)},disabled:f,children:"↑"}),t<P.length-1&&(0,r.jsx)(n.$,{size:"sm",variant:"secondary",className:"h-4 w-4 p-0 text-xs",type:"button",onClick:()=>{i&&t<a.length-1?A(t,t+1):s&&S(t-a.length,t-a.length+1)},disabled:f,children:"↓"})]})]},e.id)})}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,r.jsx)("p",{children:"• First image will be the main product image (marked with ★)"}),(0,r.jsx)("p",{children:"• Drag and drop or use arrow buttons to reorder"}),(0,r.jsx)("p",{children:"• Click the eye icon to preview full size"}),(0,r.jsx)("p",{children:"• Click the star icon to set as primary image"})]})]})]})]})}var y=t(42902),j=t(59821),N=t(25541),S=t(40228),C=t(53411),E=t(59402),k=t(46001);function A({pricingData:e,onPricingChange:a}){let[t,i]=(0,s.useState)(null),[n,c]=(0,s.useState)(!1),u=[{value:"current",label:"Current Rate",icon:N.A},{value:"static_date",label:"Static Date",icon:S.A},{value:"period_average",label:"Period Average",icon:C.A}],p=(t,r)=>{a({...e,[t]:r})},g=async e=>{if("SEK"!==e){c(!0);try{let a=await fetch(`/api/exchange-rates?from=${e}&to=SEK`),t=await a.json();i(t.rate)}catch(e){console.error("Failed to fetch exchange rate:",e)}finally{c(!1)}}},f=(()=>{let a=e.cost_amount*(t||e.exchange_rate||1),r=a*(1+e.margin_percentage/100),s=r+e.alcohol_tax_cents/100,i=e.price_includes_vat?s:1.25*s,n=function(e,a=1,t=0){return Math.round(1.25*(e*a*1.147+t/100)*100)/100}(e.cost_amount,t||e.exchange_rate||1,e.alcohol_tax_cents),l=i-a;return{costInSek:a.toFixed(2),priceBeforeTax:r.toFixed(2),priceAfterTax:s.toFixed(2),finalPrice:i.toFixed(2),finalPriceCents:Math.ceil(100*i),sbPrice:n.toFixed(2),ourMarginSek:l.toFixed(2),priceDifference:(n-i).toFixed(2),priceDifferencePercent:((n-i)/i*100).toFixed(1)}})();return(0,r.jsxs)(m.Zp,{children:[(0,r.jsxs)(m.aR,{children:[(0,r.jsxs)(m.ZB,{className:"flex items-center gap-2",children:[(0,r.jsx)(E.A,{className:"h-5 w-5"}),"Pricing Calculator"]}),(0,r.jsx)(m.BT,{children:"Configure cost, exchange rates, taxes, and margins to calculate final price"})]}),(0,r.jsxs)(m.Wu,{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"cost_currency",children:"Cost Currency"}),(0,r.jsxs)(o.l6,{value:e.cost_currency,onValueChange:a=>{p("cost_currency",a),"current"===e.exchange_rate_source&&g(a)},children:[(0,r.jsx)(o.bq,{children:(0,r.jsx)(o.yv,{})}),(0,r.jsx)(o.gC,{children:[{code:"EUR",name:"Euro (EUR)"},{code:"USD",name:"US Dollar (USD)"},{code:"GBP",name:"British Pound (GBP)"},{code:"SEK",name:"Swedish Krona (SEK)"}].map(e=>(0,r.jsx)(o.eb,{value:e.code,children:e.name},e.code))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"cost_amount",children:"Cost Amount"}),(0,r.jsx)(l.p,{id:"cost_amount",type:"number",step:"0.01",value:e.cost_amount,onChange:e=>p("cost_amount",parseFloat(e.target.value)||0),placeholder:"7.00"})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(d.J,{children:"Exchange Rate Source"}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:u.map(a=>{let t=a.icon;return(0,r.jsxs)("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${e.exchange_rate_source===a.value?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,onClick:()=>p("exchange_rate_source",a.value),children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,r.jsx)(t,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"font-medium",children:a.label})]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["current"===a.value&&"Use today's rate","static_date"===a.value&&"Use rate from specific date","period_average"===a.value&&"Use average over period"]})]},a.value)})}),"static_date"===e.exchange_rate_source&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"exchange_rate_date",children:"Exchange Rate Date"}),(0,r.jsx)(l.p,{id:"exchange_rate_date",type:"date",value:e.exchange_rate_date||"",onChange:e=>p("exchange_rate_date",e.target.value)})]}),"period_average"===e.exchange_rate_source&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"exchange_rate_period_start",children:"Period Start"}),(0,r.jsx)(l.p,{id:"exchange_rate_period_start",type:"date",value:e.exchange_rate_period_start||"",onChange:e=>p("exchange_rate_period_start",e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"exchange_rate_period_end",children:"Period End"}),(0,r.jsx)(l.p,{id:"exchange_rate_period_end",type:"date",value:e.exchange_rate_period_end||"",onChange:e=>p("exchange_rate_period_end",e.target.value)})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"exchange_rate",children:"Manual Exchange Rate (optional)"}),(0,r.jsx)(l.p,{id:"exchange_rate",type:"number",step:"0.000001",value:e.exchange_rate||"",onChange:e=>p("exchange_rate",parseFloat(e.target.value)||void 0),placeholder:"11.25"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"alcohol_tax_cents",children:"Alcohol Tax (SEK)"}),(0,r.jsx)(l.p,{id:"alcohol_tax_cents",type:"number",step:"0.01",value:(e.alcohol_tax_cents/100).toFixed(2),onChange:e=>p("alcohol_tax_cents",Math.round(100*parseFloat(e.target.value))||0),placeholder:"2.20"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"margin_percentage",children:"Margin (%)"}),(0,r.jsx)(l.p,{id:"margin_percentage",type:"number",step:"0.01",value:e.margin_percentage,onChange:e=>p("margin_percentage",parseFloat(e.target.value)||0),placeholder:"30.00"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"price_includes_vat",children:"Price Includes VAT"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(y.d,{id:"price_includes_vat",checked:e.price_includes_vat,onCheckedChange:e=>p("price_includes_vat",e)}),(0,r.jsx)(d.J,{htmlFor:"price_includes_vat",className:"text-sm",children:e.price_includes_vat?"Including VAT":"Excluding VAT"})]})]})]}),(0,r.jsxs)(m.Zp,{className:"bg-gray-50",children:[(0,r.jsx)(m.aR,{children:(0,r.jsx)(m.ZB,{className:"text-lg",children:"Price Breakdown"})}),(0,r.jsxs)(m.Wu,{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Cost in SEK:"}),(0,r.jsxs)("span",{className:"font-medium",children:[f.costInSek," SEK"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Price before tax:"}),(0,r.jsxs)("span",{className:"font-medium",children:[f.priceBeforeTax," SEK"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Price after alcohol tax:"}),(0,r.jsxs)("span",{className:"font-medium",children:[f.priceAfterTax," SEK"]})]}),(0,r.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,r.jsx)("span",{children:"Final Price:"}),(0,r.jsxs)(j.E,{variant:"default",className:"text-lg",children:[f.finalPrice," SEK"]})]})]})]}),(0,r.jsxs)(m.Zp,{className:"bg-blue-50",children:[(0,r.jsxs)(m.aR,{children:[(0,r.jsxs)(m.ZB,{className:"text-lg flex items-center gap-2",children:[(0,r.jsx)(k.A,{className:"h-5 w-5"}),"Systembolaget Comparison"]}),(0,r.jsx)(m.BT,{children:"Compare your pricing with Systembolaget's pricing (14.7% margin)"})]}),(0,r.jsxs)(m.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Your Price:"}),(0,r.jsxs)(j.E,{variant:"default",className:"text-lg",children:[f.finalPrice," SEK"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Your Margin:"}),(0,r.jsxs)("span",{className:"font-medium text-blue-600",children:[f.ourMarginSek," SEK (",e.margin_percentage,"%)"]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Systembolaget Price:"}),(0,r.jsxs)(j.E,{variant:"outline",className:"text-lg",children:[f.sbPrice," SEK"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Price Difference:"}),(0,r.jsxs)("span",{className:`font-medium ${parseFloat(f.priceDifference)>0?"text-red-600":"text-green-600"}`,children:[parseFloat(f.priceDifference)>0?"+":"",f.priceDifference," SEK (",f.priceDifferencePercent,"%)"]})]})]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600 bg-white p-3 rounded border",children:[(0,r.jsx)("strong",{children:"Competitive Analysis:"})," ",parseFloat(f.priceDifference)>0?`Systembolaget is ${f.priceDifference} SEK (${f.priceDifferencePercent}%) more expensive than your price.`:0>parseFloat(f.priceDifference)?`You are ${Math.abs(parseFloat(f.priceDifference))} SEK (${Math.abs(parseFloat(f.priceDifferencePercent))}%) more expensive than Systembolaget.`:"Your price matches Systembolaget exactly."]})]})]}),t&&"current"===e.exchange_rate_source&&(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:["Current exchange rate: 1 ",e.cost_currency," ="," ",t.toFixed(4)," SEK"]})]})]})}var P=t(70965),F=t(99270),R=t(96241);t(37826);let D=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(P.uB,{ref:t,className:(0,R.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...a}));D.displayName=P.uB.displayName;let I=s.forwardRef(({className:e,...a},t)=>(0,r.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,r.jsx)(F.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,r.jsx)(P.uB.Input,{ref:t,className:(0,R.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...a})]}));I.displayName=P.uB.Input.displayName;let z=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(P.uB.List,{ref:t,className:(0,R.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...a}));z.displayName=P.uB.List.displayName;let $=s.forwardRef((e,a)=>(0,r.jsx)(P.uB.Empty,{ref:a,className:"py-6 text-center text-sm",...e}));$.displayName=P.uB.Empty.displayName;let B=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(P.uB.Group,{ref:t,className:(0,R.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...a}));B.displayName=P.uB.Group.displayName,s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(P.uB.Separator,{ref:t,className:(0,R.cn)("-mx-1 h-px bg-border",e),...a})).displayName=P.uB.Separator.displayName;let T=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(P.uB.Item,{ref:t,className:(0,R.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...a}));T.displayName=P.uB.Item.displayName;var U=t(38729);let q=U.bL,L=U.l9,J=s.forwardRef(({className:e,align:a="center",sideOffset:t=4,...s},i)=>(0,r.jsx)(U.ZL,{children:(0,r.jsx)(U.UC,{ref:i,align:a,sideOffset:t,className:(0,R.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s})}));J.displayName=U.UC.displayName;var M=t(17971),V=t(96474),K=t(13964);function W({selectedVarieties:e,onVarietiesChange:a,availableVarieties:t,onAddNewVariety:i,disabled:l=!1}){let[c,o]=(0,s.useState)(!1),[m,u]=(0,s.useState)(""),[p,g]=(0,s.useState)(!1),f=t=>{e.includes(t)||a([...e,t]),u(""),o(!1)},h=t=>{a(e.filter(e=>e!==t))},x=async()=>{if(m.trim()&&i){g(!0);try{await i(m.trim()),u(""),o(!1)}catch(e){console.error("Failed to add new grape variety:",e)}finally{g(!1)}}},v=t.filter(a=>a.name.toLowerCase().includes(m.toLowerCase())&&!e.includes(a.id)),w=t.filter(a=>e.includes(a.id));return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(d.J,{children:"Grape Varieties"}),w.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(e=>(0,r.jsxs)(j.E,{variant:"secondary",className:"flex items-center gap-1 px-3 py-1",children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)(n.$,{type:"button",variant:"ghost",size:"sm",className:"h-auto p-0 ml-1 hover:bg-transparent",onClick:()=>h(e.id),disabled:l,children:(0,r.jsx)(_.A,{className:"h-3 w-3"})})]},e.id))}),(0,r.jsxs)(q,{open:c,onOpenChange:o,children:[(0,r.jsx)(L,{asChild:!0,children:(0,r.jsxs)(n.$,{variant:"outline",role:"combobox","aria-expanded":c,className:"w-full justify-between",disabled:l,children:[m||"Select grape varieties...",(0,r.jsx)(M.A,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,r.jsx)(J,{className:"w-full p-0",align:"start",children:(0,r.jsxs)(D,{children:[(0,r.jsx)(I,{placeholder:"Search grape varieties...",value:m,onValueChange:u}),(0,r.jsxs)(z,{children:[(0,r.jsxs)($,{children:[m&&i&&(0,r.jsx)("div",{className:"p-2",children:(0,r.jsxs)(n.$,{type:"button",variant:"outline",size:"sm",className:"w-full justify-start",onClick:x,disabled:p,children:[(0,r.jsx)(V.A,{className:"mr-2 h-4 w-4"}),'Add "',m,'"']})}),!m&&"No grape varieties found."]}),(0,r.jsx)(B,{children:v.map(a=>(0,r.jsxs)(T,{value:a.name,onSelect:()=>f(a.id),children:[(0,r.jsx)(K.A,{className:(0,R.cn)("mr-2 h-4 w-4",e.includes(a.id)?"opacity-100":"opacity-0")}),a.name,a.description&&(0,r.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",a.description,")"]})]},a.id))})]})]})})]})]})}p.callServer,p.findSourceMapURL;let G=(0,p.createServerReference)("4083e03483d950816b52d4cec2f64186bd163cf2fe",p.callServer,void 0,p.findSourceMapURL,"createGrapeVariety");function Z({wine:e,producers:a}){let[p,h]=(0,s.useState)({handle:e?.handle||"",wine_name:e?.wine_name||"",vintage:e?.vintage||"",grape_varieties:e?.grape_varieties||"",color:e?.color||"red",producer_id:e?.producer_id||"",cost_currency:e?.cost_currency||"EUR",cost_amount:e?.cost_amount||0,exchange_rate_source:e?.exchange_rate_source||"current",exchange_rate_date:e?.exchange_rate_date||void 0,exchange_rate_period_start:e?.exchange_rate_period_start||void 0,exchange_rate_period_end:e?.exchange_rate_period_end||void 0,exchange_rate:e?.exchange_rate||void 0,alcohol_tax_cents:e?.alcohol_tax_cents||0,price_includes_vat:e?.price_includes_vat??!0,margin_percentage:e?.margin_percentage||30,base_price_cents:e?.base_price_cents||0,label_image_path:e?.label_image_path||"",description:e?.description||"",description_html:e?.description_html||""}),[x,v]=(0,s.useState)([]),[w,_]=(0,s.useState)([]),[y,j]=(0,s.useState)(""),[N,S]=(0,s.useState)(!1),[C,E]=(0,s.useState)([]),[k,P]=(0,s.useState)([]),F=(0,i.useRouter)(),R=e=>{P(e);let a=C.filter(a=>e.includes(a.id)).map(e=>e.name).join(", ");h(e=>({...e,grape_varieties:a}))},D=async e=>{try{let a=await G({name:e,description:""});E(e=>[...e,a]),R([...k,a.id])}catch(e){throw console.error("Failed to create grape variety:",e),e}},I=async a=>{a.preventDefault(),S(!0),j("");let r=[];if(p.wine_name.trim()||r.push("Wine Name"),p.handle.trim()||r.push("Handle"),p.vintage.trim()||r.push("Vintage"),p.producer_id||r.push("Producer"),r.length>0){j(`Please fill in the following required fields: ${r.join(", ")}`),S(!1);return}try{let a,r=[];if(x.length>0){let e=new FormData;x.forEach(a=>{e.append("files",a)});let a=await fetch("/api/upload",{method:"POST",body:e});if(!a.ok)throw Error("Failed to upload images");r=(await a.json()).files}let s={...p,label_image_path:r.length>0?r[0]:p.label_image_path};if((a=e?await g(e.id,s):await f(s))&&r.length>0){let{createWineImage:e}=await t.e(6529).then(t.bind(t,46529));for(let t=0;t<r.length;t++)await e({wine_id:a.id,image_path:r[t],alt_text:`${a.wine_name} ${a.vintage}`,sort_order:w.length+t,is_primary:0===t&&0===w.length})}if(a&&k.length>0){let{updateWineGrapeVarieties:e}=await t.e(4486).then(t.bind(t,14486));await e(a.id,k)}F.push("/admin/wines")}catch(e){console.error("Wine creation error:",e),e instanceof Error?j(`Failed to save wine: ${e.message}`):j("An unexpected error occurred while saving the wine")}finally{S(!1)}},z=(e,a)=>{h(t=>({...t,[e]:a}))};return(0,r.jsxs)(m.Zp,{children:[(0,r.jsxs)(m.aR,{children:[(0,r.jsx)(m.ZB,{children:e?"Edit Wine":"Add Wine"}),(0,r.jsx)(m.BT,{children:e?"Update wine information":"Create a new wine product"})]}),(0,r.jsx)(m.Wu,{children:(0,r.jsxs)("form",{onSubmit:I,className:"space-y-6",children:[y&&(0,r.jsx)(u.Fc,{variant:"destructive",children:(0,r.jsx)(u.TN,{children:y})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"wine_name",children:"Wine Name *"}),(0,r.jsx)(l.p,{id:"wine_name",value:p.wine_name,onChange:e=>z("wine_name",e.target.value),required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"vintage",children:"Vintage *"}),(0,r.jsx)(l.p,{id:"vintage",value:p.vintage,onChange:e=>z("vintage",e.target.value),placeholder:"2020",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"handle",children:"Handle *"}),(0,r.jsx)(l.p,{id:"handle",value:p.handle,onChange:e=>z("handle",e.target.value),placeholder:"wine-name-vintage",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"color",children:"Color *"}),(0,r.jsxs)(o.l6,{value:p.color,onValueChange:e=>z("color",e),children:[(0,r.jsx)(o.bq,{children:(0,r.jsx)(o.yv,{})}),(0,r.jsxs)(o.gC,{children:[(0,r.jsx)(o.eb,{value:"red",children:"Red"}),(0,r.jsx)(o.eb,{value:"white",children:"White"}),(0,r.jsx)(o.eb,{value:"rose",children:"Ros\xe9"})]})]})]})]}),(0,r.jsx)(W,{selectedVarieties:k,onVarietiesChange:R,availableVarieties:C,onAddNewVariety:D,disabled:N}),(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"producer_id",children:"Producer *"}),(0,r.jsxs)(o.l6,{value:p.producer_id,onValueChange:e=>z("producer_id",e),required:!0,children:[(0,r.jsx)(o.bq,{children:(0,r.jsx)(o.yv,{placeholder:"Select a producer"})}),(0,r.jsx)(o.gC,{children:a.map(e=>(0,r.jsxs)(o.eb,{value:e.id,children:[e.name," (",e.region,")"]},e.id))})]})]})}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"description",children:"Description"}),(0,r.jsx)(c.T,{id:"description",value:p.description,onChange:e=>z("description",e.target.value),placeholder:"Enter a custom description for this wine...",rows:3}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Leave empty to use auto-generated description based on wine properties."})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(d.J,{htmlFor:"description_html",children:"Description HTML"}),(0,r.jsx)(c.T,{id:"description_html",value:p.description_html,onChange:e=>z("description_html",e.target.value),placeholder:"Enter custom HTML description (optional)...",rows:4}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Custom HTML for rich formatting. Leave empty to use auto-generated HTML from description."})]})]}),(0,r.jsx)(A,{pricingData:{cost_currency:p.cost_currency,cost_amount:p.cost_amount,exchange_rate_source:p.exchange_rate_source,exchange_rate_date:p.exchange_rate_date,exchange_rate_period_start:p.exchange_rate_period_start,exchange_rate_period_end:p.exchange_rate_period_end,exchange_rate:p.exchange_rate,alcohol_tax_cents:p.alcohol_tax_cents,price_includes_vat:p.price_includes_vat,margin_percentage:p.margin_percentage,calculated_price_cents:0},onPricingChange:e=>{h(a=>({...a,cost_currency:e.cost_currency,cost_amount:e.cost_amount,exchange_rate_source:e.exchange_rate_source,exchange_rate_date:e.exchange_rate_date,exchange_rate_period_start:e.exchange_rate_period_start,exchange_rate_period_end:e.exchange_rate_period_end,exchange_rate:e.exchange_rate,alcohol_tax_cents:e.alcohol_tax_cents,price_includes_vat:e.price_includes_vat,margin_percentage:e.margin_percentage,base_price_cents:e.finalPriceCents}))}}),(0,r.jsx)(b,{wineId:e?.id,existingImages:w,images:x,onImagesChange:v,onExistingImagesChange:_}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,r.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>F.back(),children:"Cancel"}),(0,r.jsx)(n.$,{type:"submit",disabled:N,children:N?"Saving...":e?"Update Wine":"Create Wine"})]})]})})]})}},3018:(e,a,t)=>{t.d(a,{Fc:()=>d,TN:()=>o,XL:()=>c,ju:()=>l});var r=t(60687),s=t(43210),i=t(24224),n=t(96241);let l=(0,i.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-card text-foreground",destructive:"border-destructive/50 bg-card text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 bg-green-50 text-green-700 dark:border-green-500 dark:bg-green-950 dark:text-green-300 [&>svg]:text-green-600 dark:[&>svg]:text-green-400"}},defaultVariants:{variant:"default"}}),d=s.forwardRef(({className:e,variant:a,...t},s)=>(0,r.jsx)("div",{ref:s,role:"alert",className:(0,n.cn)(l({variant:a}),e),...t}));d.displayName="Alert";let c=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("h5",{ref:t,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",e),...a}));c.displayName="AlertTitle";let o=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",e),...a}));o.displayName="AlertDescription"},15616:(e,a,t)=>{t.d(a,{T:()=>n});var r=t(60687),s=t(43210),i=t(96241);let n=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:t,...a}));n.displayName="Textarea"},37826:(e,a,t)=>{t.d(a,{Cf:()=>u,L3:()=>g,c7:()=>p,lG:()=>d,zM:()=>c});var r=t(60687),s=t(43210),i=t(25448),n=t(11860),l=t(96241);let d=i.bL,c=i.l9,o=i.ZL;i.bm;let m=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(i.hJ,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...a}));m.displayName=i.hJ.displayName;let u=s.forwardRef(({className:e,children:a,...t},s)=>(0,r.jsxs)(o,{children:[(0,r.jsx)(m,{}),(0,r.jsxs)(i.UC,{ref:s,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t,children:[a,(0,r.jsxs)(i.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(n.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));u.displayName=i.UC.displayName;let p=({className:e,...a})=>(0,r.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-left",e),...a});p.displayName="DialogHeader";let g=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(i.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",e),...a}));g.displayName=i.hE.displayName,s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(i.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",e),...a})).displayName=i.VY.displayName},39390:(e,a,t)=>{t.d(a,{J:()=>c});var r=t(60687),s=t(43210),i=t(78696),n=t(24224),l=t(96241);let d=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(i.b,{ref:t,className:(0,l.cn)(d(),e),...a}));c.displayName=i.b.displayName},42902:(e,a,t)=>{t.d(a,{d:()=>l});var r=t(60687),s=t(43210),i=t(72217),n=t(96241);let l=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)(i.bL,{className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...a,ref:t,children:(0,r.jsx)(i.zi,{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));l.displayName=i.bL.displayName},43143:(e,a,t)=>{t.d(a,{default:()=>r});let r=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/axelsamuelson/Downloads/crowdvine_01/components/admin/wine-form.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/axelsamuelson/Downloads/crowdvine_01/components/admin/wine-form.tsx","default")},55192:(e,a,t)=>{t.d(a,{BT:()=>c,Wu:()=>o,ZB:()=>d,Zp:()=>n,aR:()=>l});var r=t(60687),s=t(43210),i=t(96241);let n=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("rounded-md bg-card text-card-foreground",e),...a}));n.displayName="Card";let l=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-4",e),...a}));l.displayName="CardHeader";let d=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("font-semibold text-lg leading-none tracking-tight",e),...a}));d.displayName="CardTitle";let c=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",e),...a}));c.displayName="CardDescription";let o=s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("p-4 pt-0",e),...a}));o.displayName="CardContent",s.forwardRef(({className:e,...a},t)=>(0,r.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",e),...a})).displayName="CardFooter"},57501:(e,a,t)=>{t.d(a,{CE:()=>u,Cl:()=>p,DA:()=>m,Nr:()=>g,Rc:()=>d,Uo:()=>o,Yz:()=>h,ej:()=>x,fI:()=>c,g1:()=>f,qv:()=>n,sb:()=>l});var r=t(91199);t(42087);var s=t(7593),i=t(7944);async function n(){let e=await (0,s.w)(),{data:a,error:t}=await e.from("grape_varieties").select("*").order("name");if(t)throw Error(t.message);return a||[]}async function l(e){let a=await (0,s.w)(),{data:t,error:r}=await a.from("grape_varieties").insert({name:e.name,description:e.description||""}).select().single();if(r)throw Error(r.message);return(0,i.revalidatePath)("/admin/grape-varieties"),t}async function d(e,a,t){let r=await (0,s.w)(),{data:n,error:l}=await r.from("grape_varieties").update({name:a,description:t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(l)throw Error(l.message);return(0,i.revalidatePath)("/admin/grape-varieties"),n}async function c(e){let a=await (0,s.w)(),{error:t}=await a.from("grape_varieties").delete().eq("id",e);if(t)throw Error(t.message);(0,i.revalidatePath)("/admin/grape-varieties")}async function o(){let e=await (0,s.w)(),{data:a,error:t}=await e.from("wine_colors").select("*").order("name");if(t)throw Error(t.message);return a||[]}async function m(e,a,t){let r=await (0,s.w)(),{data:n,error:l}=await r.from("wine_colors").insert({name:e,hex_color:a,description:t}).select().single();if(l)throw Error(l.message);return(0,i.revalidatePath)("/admin/wine-colors"),n}async function u(e,a,t,r){let n=await (0,s.w)(),{data:l,error:d}=await n.from("wine_colors").update({name:a,hex_color:t,description:r,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(d)throw Error(d.message);return(0,i.revalidatePath)("/admin/wine-colors"),l}async function p(e){let a=await (0,s.w)(),{error:t}=await a.from("wine_colors").delete().eq("id",e);if(t)throw Error(t.message);(0,i.revalidatePath)("/admin/wine-colors")}async function g(e){let a=await (0,s.w)(),{data:t,error:r}=await a.from("wine_grape_varieties").select("grape_variety_id").eq("wine_id",e);if(r)throw Error(r.message);return t?.map(e=>e.grape_variety_id)||[]}async function f(e,a){let t=await (0,s.w)(),{error:r}=await t.from("wine_grape_varieties").delete().eq("wine_id",e);if(r)throw Error(r.message);if(a.length>0){let r=a.map(a=>({wine_id:e,grape_variety_id:a})),{error:s}=await t.from("wine_grape_varieties").insert(r);if(s)throw Error(s.message)}(0,i.revalidatePath)("/admin/wines"),(0,i.revalidatePath)("/admin/wines/[id]")}async function h(e){let a=await (0,s.w)(),{data:t,error:r}=await a.rpc("get_wine_with_details",{wine_id:e});if(r)throw Error(r.message);return t?.[0]||null}async function x(){let e=await (0,s.w)(),{data:a,error:t}=await e.rpc("get_all_wines_with_details");if(t)throw Error(t.message);return a||[]}(0,t(33331).D)([n,l,d,c,o,m,u,p,g,f,h,x]),(0,r.A)(n,"002e021e0c56020e41a2211cff29c17a9c0993cd50",null),(0,r.A)(l,"4083e03483d950816b52d4cec2f64186bd163cf2fe",null),(0,r.A)(d,"708f6370cc21cf0a6bb1ae7b2451b1c19e70868e69",null),(0,r.A)(c,"40435567b519ba9be7bb61fedd9075c6a59c354541",null),(0,r.A)(o,"002ea4dc2ad0a10b3daf475a02fc8a4828c734a33d",null),(0,r.A)(m,"708b871aac4be20de93ce963b708fab81d9f7a9cc8",null),(0,r.A)(u,"78ccf9802fa3aaa79af9e0eb1777ebeb0083d8fd7f",null),(0,r.A)(p,"40f67b59dbd23f203836e7181f94287618d4521a21",null),(0,r.A)(g,"40122d33d9b9ac2dc6639c2c34325ec80aecd7ef2f",null),(0,r.A)(f,"607f67b2281a2c3c1d8263f1566ee1f25c1e0b37c4",null),(0,r.A)(h,"40548cd439a776d3b6a26b675cbdc3615a9793afec",null),(0,r.A)(x,"00dad9d67047ccee2087815aec1878190770517089",null)},59821:(e,a,t)=>{t.d(a,{E:()=>d});var r=t(60687);t(43210);var s=t(11329),i=t(24224),n=t(96241);let l=(0,i.F)("inline-flex uppercase font-semibold items-center justify-center rounded-md border px-2 py-0.5 text-xs w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground","outline-secondary":"text-base border border-foreground py-0.5 px-2.5 opacity-50"}},defaultVariants:{variant:"default"}});function d({className:e,variant:a,asChild:t=!1,...i}){let d=t?s.DX:"span";return(0,r.jsx)(d,{"data-slot":"badge",className:(0,n.cn)(l({variant:a}),e),...i})}},63974:(e,a,t)=>{t.d(a,{TR:()=>h,bq:()=>g,eb:()=>x,gC:()=>f,l6:()=>o,mi:()=>v,s3:()=>m,yv:()=>u});var r=t(60687);t(43210);var s=t(94378),i=t(78272),n=t(13964),l=t(3589),d=t(24224),c=t(96241);function o({...e}){return(0,r.jsx)(s.bL,{"data-slot":"select",...e})}function m({...e}){return(0,r.jsx)(s.YJ,{"data-slot":"select-group",...e})}function u({...e}){return(0,r.jsx)(s.WT,{"data-slot":"select-value",...e})}let p=(0,d.F)("border-input bg-white data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 aria-invalid:border-destructive flex w-fit items-center justify-between gap-2 rounded-md border px-3 py-2 text-base md:text-sm whitespace-nowrap shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-1 disabled:cursor-not-allowed disabled:opacity-50 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 aria-[invalid=true]:border-red-500 aria-[invalid=true]:focus-visible:ring-red-500",{variants:{size:{sm:"h-8 text-sm",default:"h-10"}},defaultVariants:{size:"default"}});function g({className:e,size:a,children:t,...n}){return(0,r.jsxs)(s.l9,{"data-slot":"select-trigger",className:(0,c.cn)(p({size:a,className:e})),...n,children:[t,(0,r.jsx)(s.In,{asChild:!0,children:(0,r.jsx)(i.A,{className:"opacity-50 size-4"})})]})}function f({className:e,children:a,position:t="popper",...i}){return(0,r.jsx)(s.ZL,{children:(0,r.jsxs)(s.UC,{"data-slot":"select-content",className:(0,c.cn)("bg-popover/80 backdrop-blur-md text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md","popper"===t&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:t,...i,children:[(0,r.jsx)(w,{}),(0,r.jsx)(s.LM,{className:(0,c.cn)("p-1","popper"===t&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:a}),(0,r.jsx)(_,{})]})})}function h({className:e,...a}){return(0,r.jsx)(s.JU,{"data-slot":"select-label",className:(0,c.cn)("text-muted-foreground px-2 py-1.5 text-xs",e),...a})}function x({className:e,children:a,...t}){return(0,r.jsxs)(s.q7,{"data-slot":"select-item",className:(0,c.cn)("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...t,children:[(0,r.jsx)("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:(0,r.jsx)(s.VF,{children:(0,r.jsx)(n.A,{className:"size-4"})})}),(0,r.jsx)(s.p4,{children:a})]})}function v({className:e,...a}){return(0,r.jsx)(s.wv,{"data-slot":"select-separator",className:(0,c.cn)("-mx-1 my-1 h-px pointer-events-none bg-input",e),...a})}function w({className:e,...a}){return(0,r.jsx)(s.PP,{"data-slot":"select-scroll-up-button",className:(0,c.cn)("flex justify-center items-center py-1 cursor-default",e),...a,children:(0,r.jsx)(l.A,{className:"size-4"})})}function _({className:e,...a}){return(0,r.jsx)(s.wn,{"data-slot":"select-scroll-down-button",className:(0,c.cn)("flex justify-center items-center py-1 cursor-default",e),...a,children:(0,r.jsx)(i.A,{className:"size-4"})})}},68988:(e,a,t)=>{t.d(a,{j:()=>n,p:()=>l});var r=t(60687),s=t(43210),i=t(96241);let n=(0,t(24224).F)("flex w-full rounded-full transition-[background-color,box-shadow] backdrop-blur-sm duration-200 ease-out bg-primary/20 shadow-sm ring-1 ring-transparent focus-visible:bg-primary/20 focus-visible:ring-1 focus-visible:ring-primary/40 focus-visible:ring-offset-4 focus-visible:ring-offset-black/10 disabled:cursor-not-allowed disabled:opacity-50 md:text-base text-white border-2 border-white/50 h-11 !text-base placeholder:text-white/80 focus:outline-none px-4"),l=s.forwardRef(({className:e,type:a,...t},s)=>(0,r.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-white px-3 py-1 text-base transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","aria-[invalid=true]:border-red-500 aria-[invalid=true]:focus-visible:!ring-red-500",e),ref:s,...t}));l.displayName="Input"},89144:(e,a,t)=>{t.d(a,{H:()=>n,w:()=>i});var r=t(44999),s=t(34386);async function i(){let e=await (0,r.UL)(),a="https://abrnvjqwpdkodgrtezeg.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFicm52anF3cGRrb2RncnRlemVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NzQwNjMsImV4cCI6MjA3MjI1MDA2M30.I_i63rAdVM51CKwic2GhNY5z7WKzA8p8OdVVh8-YiGs";if(!a||!t)throw console.error("Missing Supabase environment variables:"),console.error("NEXT_PUBLIC_SUPABASE_URL:",a?"SET":"MISSING"),console.error("NEXT_PUBLIC_SUPABASE_ANON_KEY:",t?"SET":"MISSING"),Error("Supabase environment variables are not configured. Please check your .env.local file.");return(0,s.createServerClient)(a,t,{cookies:{get:a=>e.get(a)?.value,set(e,a,t){console.log(`Cookie ${e} would be set to ${a}`)},remove(e,a){console.log(`Cookie ${e} would be removed`)}}})}async function n(){let e=await i(),{data:{user:a},error:t}=await e.auth.getUser();return t?(console.error("Error getting current user:",t),null):a}},92733:(e,a,t)=>{t.d(a,{Cw:()=>n,Lb:()=>l,eA:()=>c,et:()=>d,jc:()=>m,pb:()=>o});var r=t(91199);t(42087);var s=t(7593),i=t(7944);async function n(e){let a=await (0,s.w)();try{let{data:t,error:r}=await a.from("wine_images").select("*").eq("wine_id",e).order("sort_order",{ascending:!0});if(r){if("PGRST205"===r.code||r.message.includes("wine_images"))return console.warn("wine_images table not found, returning empty array"),[];throw Error(r.message)}return t||[]}catch(e){return console.warn("Error fetching wine images:",e),[]}}async function l(e){let a=await (0,s.w)();try{e.is_primary&&await a.from("wine_images").update({is_primary:!1}).eq("wine_id",e.wine_id);let{data:t,error:r}=await a.from("wine_images").insert(e).select("*").single();if(r){if("PGRST205"===r.code||r.message.includes("wine_images"))throw Error("wine_images table not found. Please create the table first.");throw Error(r.message)}return(0,i.revalidatePath)(`/admin/wines/${e.wine_id}`),(0,i.revalidatePath)(`/product/${e.wine_id}`),t}catch(e){throw console.error("Error creating wine image:",e),e}}async function d(e,a){let t=await (0,s.w)();if(a.is_primary){let{data:a}=await t.from("wine_images").select("wine_id").eq("id",e).single();a&&await t.from("wine_images").update({is_primary:!1}).eq("wine_id",a.wine_id).neq("id",e)}let{data:r,error:n}=await t.from("wine_images").update(a).eq("id",e).select("*").single();if(n)throw Error(n.message);return(0,i.revalidatePath)(`/admin/wines/${r.wine_id}`),(0,i.revalidatePath)(`/product/${r.wine_id}`),r}async function c(e){let a=await (0,s.w)(),{data:t}=await a.from("wine_images").select("wine_id").eq("id",e).single(),{error:r}=await a.from("wine_images").delete().eq("id",e);if(r)throw Error(r.message);t&&((0,i.revalidatePath)(`/admin/wines/${t.wine_id}`),(0,i.revalidatePath)(`/product/${t.wine_id}`))}async function o(e,a){let t=await (0,s.w)(),r=a.map((a,r)=>t.from("wine_images").update({sort_order:r}).eq("id",a).eq("wine_id",e));await Promise.all(r),(0,i.revalidatePath)(`/admin/wines/${e}`),(0,i.revalidatePath)(`/product/${e}`)}async function m(e){let a=await (0,s.w)(),{data:t}=await a.from("wine_images").select("wine_id").eq("id",e).single();if(!t)throw Error("Image not found");await a.from("wine_images").update({is_primary:!1}).eq("wine_id",t.wine_id);let{error:r}=await a.from("wine_images").update({is_primary:!0}).eq("id",e);if(r)throw Error(r.message);(0,i.revalidatePath)(`/admin/wines/${t.wine_id}`),(0,i.revalidatePath)(`/product/${t.wine_id}`)}(0,t(33331).D)([n,l,d,c,o,m]),(0,r.A)(n,"40ce8871619036d57b154ab277344d98057d64625a",null),(0,r.A)(l,"40602db00dc1f3eddf4c0b082bfdaf3337bddd9557",null),(0,r.A)(d,"606cc753fa3f401d4e50e1daf057d012238334d58a",null),(0,r.A)(c,"40980db330eb06486ba5f0a705ca9af0a43edd2894",null),(0,r.A)(o,"600e45b92ba2dc0c68473d481ab3a3af50b0568aee",null),(0,r.A)(m,"40666ecefbb349c0131a2084fe5cab87277ca4d24b",null)},96273:(e,a,t)=>{t.d(a,{Re:()=>l,iF:()=>n,j2:()=>d,k4:()=>c,m0:()=>o});var r=t(67218);t(79130);var s=t(89144),i=t(62351);async function n(){let e=await (0,s.w)(),{data:a,error:t}=await e.from("producers").select("*").order("name");if(t)throw Error(t.message);return a}async function l(e){let a=await (0,s.w)(),{data:t,error:r}=await a.from("producers").select("*").eq("id",e).single();if(r)throw Error(r.message);return t}async function d(e){let a=await (0,s.w)(),{data:t,error:r}=await a.from("producers").insert(e).select().single();if(r)throw Error(r.message);return(0,i.revalidatePath)("/admin/producers"),t}async function c(e,a){let t=await (0,s.w)(),{data:r,error:n}=await t.from("producers").update(a).eq("id",e).select().single();if(n)throw Error(n.message);return(0,i.revalidatePath)("/admin/producers"),(0,i.revalidatePath)(`/admin/producers/${e}`),r}async function o(e){let a=await (0,s.w)(),{error:t}=await a.from("producers").delete().eq("id",e);if(t)throw Error(t.message);(0,i.revalidatePath)("/admin/producers")}(0,t(17478).D)([n,l,d,c,o]),(0,r.A)(n,"000419a02be5c3cbea5dea69027c634a78070fef84",null),(0,r.A)(l,"4077deae77c3cfba85f382e6c438cba7d6df8b8eb5",null),(0,r.A)(d,"407cc8c4465a7985dbae48dd93d0b97fd1d9938259",null),(0,r.A)(c,"605ef108f16894d4d036ef44663d30f2fdb4f32d28",null),(0,r.A)(o,"40b12d636f61a9110f1b62f3fedd98279008199168",null)}};