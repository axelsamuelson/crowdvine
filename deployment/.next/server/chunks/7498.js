exports.id=7498,exports.ids=[7498],exports.modules={18092:(e,r,n)=>{"use strict";n.d(r,{CI:()=>l,bN:()=>s,bm:()=>o});var a=n(67218);n(79130);var i=n(34386),t=n(44999);async function s(e,r){try{console.log("Admin login attempt for:",e);let n=await (0,t.UL)(),a=(0,i.createServerClient)("https://abrnvjqwpdkodgrtezeg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFicm52anF3cGRrb2RncnRlemVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NzQwNjMsImV4cCI6MjA3MjI1MDA2M30.I_i63rAdVM51CKwic2GhNY5z7WKzA8p8OdVVh8-YiGs",{cookies:{get:e=>n.get(e)?.value,set:(e,r,a)=>{n.set(e,r,a)},remove:(e,r)=>{n.set(e,"",r)}}}),{data:s,error:o}=await a.auth.signInWithPassword({email:e,password:r});if(o)return console.error("Login error:",o),{error:`Inloggning misslyckades: ${o.message}`};if(!s?.user)return{error:"Ingen anv\xe4ndare returnerades"};console.log("User authenticated:",s.user.id);let{data:l,error:c}=await a.from("profiles").select("role").eq("id",s.user.id).single();if(c)return console.error("Profile fetch error:",c),{error:"Kunde inte h\xe4mta anv\xe4ndarprofil"};if(l?.role!=="admin")return{error:"Du har inte admin-beh\xf6righet"};return console.log("Admin role verified"),{success:!0}}catch(e){return console.error("Unexpected error in admin login:",e),{error:"Ett ov\xe4ntat fel uppstod"}}}async function o(e,r){try{console.log("Creating admin account for:",e);let n=(0,i.createServerClient)("https://abrnvjqwpdkodgrtezeg.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{get:e=>"",set:(e,r,n)=>{},remove:(e,r)=>{}}}),{data:a,error:t}=await n.auth.admin.createUser({email:e,password:r,email_confirm:!0,user_metadata:{role:"admin"}});if(t){if(console.error("Auth creation error:",t),t.message.includes("already been registered")){console.log("User already exists, attempting to create profile...");let{data:r}=await n.auth.admin.listUsers(),a=r.users.find(r=>r.email===e);if(a){let{data:e}=await n.from("profiles").select("*").eq("id",a.id).single();if(e)return{error:"Anv\xe4ndare finns redan och har en profil. Logga in ist\xe4llet."};{let{error:e}=await n.from("profiles").insert({id:a.id,email:a.email,role:"admin",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(e)return console.error("Profile creation error for existing user:",e),{error:`Kunde inte skapa profil f\xf6r befintlig anv\xe4ndare: ${e.message}`};return console.log("Profile created for existing user"),{success:!0,message:"Profil skapad f\xf6r befintlig anv\xe4ndare! Du kan nu logga in.",user:{id:a.id,email:a.email,role:"admin"}}}}}return{error:`Kunde inte skapa anv\xe4ndare: ${t.message}`}}if(!a.user)return{error:"Ingen anv\xe4ndare skapades"};console.log("Auth user created:",a.user.id);let{error:s}=await n.from("profiles").insert({id:a.user.id,email:a.user.email,role:"admin",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(s){console.error("Profile creation error:",s);try{await n.auth.admin.deleteUser(a.user.id)}catch(e){console.error("Failed to cleanup user after profile creation failure:",e)}return{error:`Kunde inte skapa profil: ${s.message}`}}return console.log("Profile created successfully"),{success:!0,message:"Admin-konto skapat framg\xe5ngsrikt!",user:{id:a.user.id,email:a.user.email,role:"admin"}}}catch(e){return console.error("Unexpected error in create admin account:",e),{error:"Ett ov\xe4ntat fel uppstod"}}}async function l(){try{console.log("Signing out admin user");let e=await (0,t.UL)(),r=(0,i.createServerClient)("https://abrnvjqwpdkodgrtezeg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFicm52anF3cGRrb2RncnRlemVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NzQwNjMsImV4cCI6MjA3MjI1MDA2M30.I_i63rAdVM51CKwic2GhNY5z7WKzA8p8OdVVh8-YiGs",{cookies:{get:r=>e.get(r)?.value,set:(r,n,a)=>{e.set(r,n,a)},remove:(r,n)=>{e.set(r,"",n)}}}),{error:n}=await r.auth.signOut();if(n)return console.error("Sign out error:",n),{error:`Utloggning misslyckades: ${n.message}`};return console.log("Admin user signed out successfully"),{success:!0}}catch(e){return console.error("Unexpected error in sign out:",e),{error:"Ett ov\xe4ntat fel uppstod"}}}(0,n(17478).D)([s,o,l]),(0,a.A)(s,"60e23ebd701beaf98fa7a72caaec9d44d01e5ad1f4",null),(0,a.A)(o,"60efcc50e52f4883661f2378341594fcdbc0bab423",null),(0,a.A)(l,"007576a7507c003d41ccbb09c6db34287f05775842",null)},41098:(e,r,n)=>{"use strict";n.d(r,{HW:()=>l});var a=n(83008),i=n(34386),t=n(44999);let s="https://abrnvjqwpdkodgrtezeg.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFicm52anF3cGRrb2RncnRlemVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NzQwNjMsImV4cCI6MjA3MjI1MDA2M30.I_i63rAdVM51CKwic2GhNY5z7WKzA8p8OdVVh8-YiGs";async function l(){try{let e=await (0,t.UL)(),r=(0,i.createServerClient)(s,o,{cookies:{get:r=>e.get(r)?.value,set:(r,n,a)=>{e.set(r,n,a)},remove:(r,n)=>{e.set(r,"",n)}}}),{data:{user:n},error:a}=await r.auth.getUser();if(a||!n)return console.log("Auth error or no user:",a),null;console.log("User found in auth:",n.id);let{data:l,error:c}=await r.from("profiles").select("role, producer_id").eq("id",n.id).single();if(c)return console.log("Profile fetch error:",c),null;return console.log("Profile found:",l),{id:n.id,email:n.email,role:l?.role||"user",producer_id:l?.producer_id}}catch(e){return console.error("Error in getCurrentUser:",e),null}}(0,a.UU)(s,o)},42548:(e,r,n)=>{"use strict";n.r(r),n.d(r,{$$RSC_SERVER_ACTION_0:()=>c,default:()=>d});var a=n(37413),i=n(67218);n(79130);var t=n(39916),s=n(18092),o=n(41098),l=n(51310);let c=async function(){await (0,s.CI)(),(0,t.redirect)("/admin-auth/login")};async function d({children:e}){let r=await (0,o.HW)();r||(0,t.redirect)("/admin-auth/login");let{getSupabaseAdmin:s}=await n.e(1268).then(n.bind(n,11268)),d=s(),{data:m}=await d.from("profiles").select("role, email").eq("id",r.id).single();m&&"admin"===m.role||(0,t.redirect)("/admin-auth/login");var u=(0,i.A)(c,"003782174d8a3d55037297099e3a362cb75f58328c",null);return(0,a.jsx)(l.AdminLayoutClient,{userEmail:m.email||r.email||"Unknown",onSignOut:u,children:e})}},49205:(e,r,n)=>{Promise.resolve().then(n.bind(n,51310))},51310:(e,r,n)=>{"use strict";n.d(r,{AdminLayoutClient:()=>a});let a=(0,n(12907).registerClientReference)(function(){throw Error("Attempted to call AdminLayoutClient() from the server but AdminLayoutClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/admin-layout-client.tsx","AdminLayoutClient")},87139:(e,r,n)=>{"use strict";n.d(r,{AdminLayoutClient:()=>N});var a=n(60687),i=n(85814),t=n.n(i),s=n(16189),o=n(96241),l=n(24934),c=n(43210),d=n(12327);let m=c.forwardRef(({className:e,children:r,...n},i)=>(0,a.jsxs)(d.bL,{ref:i,className:(0,o.cn)("relative overflow-hidden",e),...n,children:[(0,a.jsx)(d.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(u,{}),(0,a.jsx)(d.OK,{})]}));m.displayName=d.bL.displayName;let u=c.forwardRef(({className:e,orientation:r="vertical",...n},i)=>(0,a.jsx)(d.VM,{ref:i,orientation:r,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...n,children:(0,a.jsx)(d.lr,{className:"relative flex-1 rounded-full bg-border"})}));u.displayName=d.VM.displayName;var f=n(49625),g=n(41312),h=n(3335),p=n(97992),x=n(19080),b=n(40228),v=n(10022),I=n(80428),w=n(99891),y=n(40083);let j=[{name:"Dashboard",href:"/admin",icon:f.A},{name:"Users",href:"/admin/users",icon:g.A},{name:"Producers",href:"/admin/producers",icon:h.A},{name:"Wines",href:"/admin/wines",icon:h.A},{name:"Zones",href:"/admin/zones",icon:p.A},{name:"Pallets",href:"/admin/pallets",icon:x.A},{name:"Bookings",href:"/admin/bookings",icon:b.A},{name:"Reservations",href:"/admin/reservations",icon:v.A},{name:"Wine Boxes",href:"/admin/wine-boxes",icon:I.A},{name:"Access Control",href:"/admin/access-control",icon:w.A}];function A({userEmail:e,onSignOut:r}){let n=(0,s.usePathname)();return(0,a.jsxs)("div",{className:"flex h-full w-64 flex-col bg-white border-r border-gray-200",children:[(0,a.jsx)("div",{className:"flex h-16 items-center px-6 border-b border-gray-200",children:(0,a.jsxs)(t(),{href:"/admin",className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-gray-900 rounded-lg flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white font-bold text-sm",children:"C"})}),(0,a.jsx)("span",{className:"text-xl font-bold text-gray-900",children:"CrowdVine"})]})}),(0,a.jsx)(m,{className:"flex-1 px-3 py-4",children:(0,a.jsx)("nav",{className:"space-y-1",children:j.map(e=>{let r=n===e.href;return(0,a.jsxs)(t(),{href:e.href,className:(0,o.cn)("flex items-center px-3 py-2 text-sm font-medium rounded-lg transition-colors",r?"bg-gray-100 text-gray-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"),children:[(0,a.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})})}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,a.jsx)("div",{className:"h-8 w-8 bg-gray-200 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-gray-600 font-medium text-sm",children:e.charAt(0).toUpperCase()})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 truncate",children:e}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"Admin"})]})]}),(0,a.jsxs)(l.$,{variant:"outline",size:"sm",onClick:r,className:"w-full justify-start",children:[(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"Sign Out"]})]})]})}function N({children:e,userEmail:r,onSignOut:n}){return(0,a.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[(0,a.jsx)(A,{userEmail:r,onSignOut:n}),(0,a.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden",children:(0,a.jsx)("main",{className:"flex-1 overflow-y-auto p-6",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto",children:e})})})]})}},91061:(e,r,n)=>{Promise.resolve().then(n.bind(n,87139))}};