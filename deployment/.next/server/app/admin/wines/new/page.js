(()=>{var e={};e.id=7778,e.ids=[7778],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3787:(e,a,r)=>{"use strict";r.r(a),r.d(a,{GlobalError:()=>n.a,__next_app__:()=>l,pages:()=>_,routeModule:()=>p,tree:()=>o});var t=r(65239),c=r(48088),i=r(88170),n=r.n(i),d=r(30893),s={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(s[e]=()=>d[e]);r.d(a,s);let o={children:["",{children:["admin",{children:["wines",{children:["new",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,91185)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/wines/new/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,42548)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[async e=>(await Promise.resolve().then(r.bind(r,90253))).default(e)],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,58014)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,52608)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/error.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,82366)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[async e=>(await Promise.resolve().then(r.bind(r,90253))).default(e)],twitter:[],manifest:void 0}}]}.children,_=["/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/wines/new/page.tsx"],l={require:r,loadChunk:()=>Promise.resolve()},p=new t.AppPageRouteModule({definition:{kind:c.RouteKind.APP_PAGE,page:"/admin/wines/new/page",pathname:"/admin/wines/new",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20275:(e,a,r)=>{"use strict";r.r(a),r.d(a,{"000419a02be5c3cbea5dea69027c634a78070fef84":()=>i.iF,"003782174d8a3d55037297099e3a362cb75f58328c":()=>t.$$RSC_SERVER_ACTION_0,"007576a7507c003d41ccbb09c6db34287f05775842":()=>c.CI,"4077deae77c3cfba85f382e6c438cba7d6df8b8eb5":()=>i.Re,"407cc8c4465a7985dbae48dd93d0b97fd1d9938259":()=>i.j2,"40b12d636f61a9110f1b62f3fedd98279008199168":()=>i.m0,"605ef108f16894d4d036ef44663d30f2fdb4f32d28":()=>i.k4,"60e23ebd701beaf98fa7a72caaec9d44d01e5ad1f4":()=>c.bN,"60efcc50e52f4883661f2378341594fcdbc0bab423":()=>c.bm});var t=r(42548),c=r(18092),i=r(96273)},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31651:(e,a,r)=>{Promise.resolve().then(r.bind(r,43143))},33873:e=>{"use strict";e.exports=require("path")},45723:(e,a,r)=>{Promise.resolve().then(r.bind(r,552))},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},62834:(e,a,r)=>{"use strict";r.r(a),r.d(a,{"002b4f93fdecce38ab41447362701e3bd7280469ab":()=>c.h,"002e021e0c56020e41a2211cff29c17a9c0993cd50":()=>n.qv,"002ea4dc2ad0a10b3daf475a02fc8a4828c734a33d":()=>n.Uo,"00643ce809e6ce20ef66f5929e0946f9a0888cb71e":()=>t.Xl,"006ce0741515c18fd40bece93393d603e10d5a23d5":()=>t.EM,"00dad9d67047ccee2087815aec1878190770517089":()=>n.ej,"00f5f7f80f14491a3796af19d4a438f72ece93c2e1":()=>l,"4007494c21df392b4022c081277df8425dc3491bf1":()=>p,"40122d33d9b9ac2dc6639c2c34325ec80aecd7ef2f":()=>n.Nr,"402eefbf27465ab7a9e2720f0501458518d9ba2628":()=>t.B5,"40400762e92e9a18c27f749da35b9792097f301365":()=>u,"40435567b519ba9be7bb61fedd9075c6a59c354541":()=>n.fI,"40449b4a1fa1b1e01c1a42429d8368c02ccf0e79e1":()=>b,"404ce88c125f79e5b61af93c3739bd192b253aa6f7":()=>t.fk,"40548cd439a776d3b6a26b675cbdc3615a9793afec":()=>n.Yz,"40602db00dc1f3eddf4c0b082bfdaf3337bddd9557":()=>i.Lb,"40666ecefbb349c0131a2084fe5cab87277ca4d24b":()=>i.jc,"4083e03483d950816b52d4cec2f64186bd163cf2fe":()=>n.sb,"40980db330eb06486ba5f0a705ca9af0a43edd2894":()=>i.eA,"40ce8871619036d57b154ab277344d98057d64625a":()=>i.Cw,"40f67b59dbd23f203836e7181f94287618d4521a21":()=>n.Cl,"600d783cb3bc5d9bf756e6d6da6ee83de2ee57c3f9":()=>f,"600e45b92ba2dc0c68473d481ab3a3af50b0568aee":()=>i.pb,"606cc753fa3f401d4e50e1daf057d012238334d58a":()=>i.et,"607f67b2281a2c3c1d8263f1566ee1f25c1e0b37c4":()=>n.g1,"708b871aac4be20de93ce963b708fab81d9f7a9cc8":()=>n.DA,"708f6370cc21cf0a6bb1ae7b2451b1c19e70868e69":()=>n.Rc,"78ccf9802fa3aaa79af9e0eb1777ebeb0083d8fd7f":()=>n.CE});var t=r(45063),c=r(23234),i=r(92733),n=r(57501),d=r(91199);r(42087);var s=r(7593),o=r(7944);function _(e,a=1,r=0){return Math.round(1.25*(e*a*1.147+r/100)*100)/100}async function l(){let e=await (0,s.w)(),{data:a,error:r}=await e.from("wines").select(`
      id,
      handle,
      wine_name,
      vintage,
      grape_varieties,
      color,
      label_image_path,
      base_price_cents,
      producer_id,
      cost_currency,
      cost_amount,
      exchange_rate_source,
      exchange_rate_date,
      exchange_rate_period_start,
      exchange_rate_period_end,
      exchange_rate,
      alcohol_tax_cents,
      price_includes_vat,
      margin_percentage,
      calculated_price_cents,
      supplier_price,
      sb_price,
      volume_liters,
      description,
      description_html,
      created_at,
      updated_at
    `).order("wine_name");if(r)throw Error(r.message);let t=[...new Set(a.map(e=>e.producer_id))],{data:c}=await e.from("producers").select("id, name").in("id",t),i=new Map(c?.map(e=>[e.id,e])||[]);return a.map(e=>({...e,producer:i.get(e.producer_id)}))}async function p(e){let a=await (0,s.w)(),{data:r,error:t}=await a.from("wines").select(`
      id,
      handle,
      wine_name,
      vintage,
      grape_varieties,
      color,
      label_image_path,
      base_price_cents,
      producer_id,
      cost_currency,
      cost_amount,
      exchange_rate_source,
      exchange_rate_date,
      exchange_rate_period_start,
      exchange_rate_period_end,
      exchange_rate,
      alcohol_tax_cents,
      price_includes_vat,
      margin_percentage,
      calculated_price_cents,
      supplier_price,
      sb_price,
      volume_liters,
      description,
      description_html,
      created_at,
      updated_at
    `).eq("id",e).single();if(t)throw Error(t.message);let{data:c}=await a.from("producers").select("name").eq("id",r.producer_id).single();return{...r,producer:c}}async function u(e){let a=await (0,s.w)(),r=e.base_price_cents,t=null;if(e.cost_amount&&e.cost_amount>0){let a=e.exchange_rate||1,c=e.cost_amount*a*(1+(e.margin_percentage||30)/100)+(e.alcohol_tax_cents||0)/100;r=Math.ceil(100*(!1!==e.price_includes_vat?c:1.25*c)),e.cost_amount&&e.cost_amount>0&&(t=_(e.cost_amount,e.exchange_rate||1,e.alcohol_tax_cents||0))}let c={...e,base_price_cents:r,calculated_price_cents:r,sb_price:t},{data:i,error:n}=await a.from("wines").insert(c).select(`
      id,
      handle,
      wine_name,
      vintage,
      grape_varieties,
      color,
      label_image_path,
      base_price_cents,
      producer_id,
      cost_currency,
      cost_amount,
      exchange_rate_source,
      exchange_rate_date,
      exchange_rate_period_start,
      exchange_rate_period_end,
      exchange_rate,
      alcohol_tax_cents,
      price_includes_vat,
      margin_percentage,
      calculated_price_cents,
      supplier_price,
      sb_price,
      volume_liters,
      created_at,
      updated_at
    `).single();if(n)throw Error(n.message);let{data:d}=await a.from("producers").select("name").eq("id",i.producer_id).single(),l={...i,producer:d};return(0,o.revalidatePath)("/admin/wines"),l}async function f(e,a){let r=await (0,s.w)(),t={};if(void 0!==a.handle&&(t.handle=a.handle),void 0!==a.wine_name&&(t.wine_name=a.wine_name),void 0!==a.vintage&&(t.vintage=a.vintage),void 0!==a.grape_varieties&&(t.grape_varieties=a.grape_varieties),void 0!==a.color&&(t.color=a.color),void 0!==a.label_image_path&&(t.label_image_path=a.label_image_path),void 0!==a.base_price_cents&&(t.base_price_cents=a.base_price_cents),void 0!==a.producer_id&&(t.producer_id=a.producer_id),void 0!==a.cost_currency&&(t.cost_currency=a.cost_currency),void 0!==a.cost_amount&&(t.cost_amount=a.cost_amount),void 0!==a.exchange_rate_source&&(t.exchange_rate_source=a.exchange_rate_source),void 0!==a.exchange_rate_date&&(t.exchange_rate_date=a.exchange_rate_date),void 0!==a.exchange_rate_period_start&&(t.exchange_rate_period_start=a.exchange_rate_period_start),void 0!==a.exchange_rate_period_end&&(t.exchange_rate_period_end=a.exchange_rate_period_end),void 0!==a.exchange_rate&&(t.exchange_rate=a.exchange_rate),void 0!==a.alcohol_tax_cents&&(t.alcohol_tax_cents=a.alcohol_tax_cents),void 0!==a.price_includes_vat&&(t.price_includes_vat=a.price_includes_vat),void 0!==a.margin_percentage&&(t.margin_percentage=a.margin_percentage),void 0!==a.description&&(t.description=a.description),void 0!==a.description_html&&(t.description_html=a.description_html),void 0!==a.supplier_price&&(t.supplier_price=a.supplier_price),void 0!==a.volume_liters&&(t.volume_liters=a.volume_liters),void 0!==t.cost_amount||void 0!==t.exchange_rate||void 0!==t.alcohol_tax_cents||void 0!==t.price_includes_vat||void 0!==t.margin_percentage){let{data:a}=await r.from("wines").select("cost_amount, exchange_rate, alcohol_tax_cents, price_includes_vat, margin_percentage, volume_liters").eq("id",e).single(),c=t.cost_amount??a?.cost_amount??0,i=t.exchange_rate??a?.exchange_rate??1,n=t.alcohol_tax_cents??a?.alcohol_tax_cents??0,d=t.price_includes_vat??a?.price_includes_vat??!0,s=c*i*(1+(t.margin_percentage??a?.margin_percentage??30)/100)+n/100,o=Math.ceil(100*(d?s:1.25*s));t.calculated_price_cents=o,t.base_price_cents=o}if(void 0!==t.cost_amount&&t.cost_amount>0){let e=t.exchange_rate??currentWine?.exchange_rate??1,a=t.alcohol_tax_cents??currentWine?.alcohol_tax_cents??0;t.sb_price=_(t.cost_amount,e,a)}let{data:c,error:i}=await r.from("wines").update(t).eq("id",e).select(`
      id,
      handle,
      wine_name,
      vintage,
      grape_varieties,
      color,
      label_image_path,
      base_price_cents,
      producer_id,
      cost_currency,
      cost_amount,
      exchange_rate_source,
      exchange_rate_date,
      exchange_rate_period_start,
      exchange_rate_period_end,
      exchange_rate,
      alcohol_tax_cents,
      price_includes_vat,
      margin_percentage,
      calculated_price_cents,
      supplier_price,
      sb_price,
      volume_liters,
      created_at,
      updated_at
    `).single();if(i)throw console.error("Update wine error:",i),Error(i.message);let{data:n}=await r.from("producers").select("name").eq("id",c.producer_id).single(),d={...c,producer:n};return(0,o.revalidatePath)("/admin/wines"),(0,o.revalidatePath)(`/admin/wines/${e}`),d}async function b(e){let a=await (0,s.w)(),{error:r}=await a.from("wines").delete().eq("id",e);if(r)throw Error(r.message);(0,o.revalidatePath)("/admin/wines")}(0,r(33331).D)([l,p,u,f,b]),(0,d.A)(l,"00f5f7f80f14491a3796af19d4a438f72ece93c2e1",null),(0,d.A)(p,"4007494c21df392b4022c081277df8425dc3491bf1",null),(0,d.A)(u,"40400762e92e9a18c27f749da35b9792097f301365",null),(0,d.A)(f,"600d783cb3bc5d9bf756e6d6da6ee83de2ee57c3f9",null),(0,d.A)(b,"40449b4a1fa1b1e01c1a42429d8368c02ccf0e79e1",null)},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91185:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>n});var t=r(37413),c=r(96273),i=r(43143);async function n(){let e=await (0,c.iF)();return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Add Wine"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Create a new wine product"})]}),(0,t.jsx)(i.default,{producers:e})]})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[4447,3008,4999,4386,8167,6355,8013,1410,5448,758,2351,2579,5258,7498,4454],()=>r(3787));module.exports=t})();