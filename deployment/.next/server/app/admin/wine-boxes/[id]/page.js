(()=>{var e={};e.id=8392,e.ids=[8392],e.modules={3018:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>l,TN:()=>c,XL:()=>d,ju:()=>o});var s=r(60687),i=r(43210),a=r(24224),n=r(96241);let o=(0,a.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-3 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-card text-foreground",destructive:"border-destructive/50 bg-card text-destructive dark:border-destructive [&>svg]:text-destructive",success:"border-green-500/50 bg-green-50 text-green-700 dark:border-green-500 dark:bg-green-950 dark:text-green-300 [&>svg]:text-green-600 dark:[&>svg]:text-green-400"}},defaultVariants:{variant:"default"}}),l=i.forwardRef(({className:e,variant:t,...r},i)=>(0,s.jsx)("div",{ref:i,role:"alert",className:(0,n.cn)(o({variant:t}),e),...r}));l.displayName="Alert";let d=i.forwardRef(({className:e,...t},r)=>(0,s.jsx)("h5",{ref:r,className:(0,n.cn)("mb-1 font-medium leading-none tracking-tight",e),...t}));d.displayName="AlertTitle";let c=i.forwardRef(({className:e,...t},r)=>(0,s.jsx)("div",{ref:r,className:(0,n.cn)("text-sm [&_p]:leading-relaxed",e),...t}));c.displayName="AlertDescription"},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4396:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var s=r(60687),i=r(43210),a=r(16189),n=r(24934),o=r(68988),l=r(39390),d=r(15616),c=r(55192),p=r(3018),x=r(61104),m=r(26240);function u({wineBox:e,wineBoxItems:t=[]}){let[r,u]=(0,i.useState)({name:e?.name||"",description:e?.description||"",handle:e?.handle||"",margin_percentage:e?.margin_percentage?.toString()||"",image_url:e?.image_url||"",is_active:e?.is_active??!0}),[h,g]=(0,i.useState)([]),[v,f]=(0,i.useState)([]),[b,w]=(0,i.useState)(!1),[j,y]=(0,i.useState)(null),N=(0,a.useRouter)(),_=(e,t)=>{if(u(r=>({...r,[e]:t})),"name"===e){let e=t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");u(t=>({...t,handle:e}))}},k=async t=>{if(t.preventDefault(),0===h.length){y("Please select at least one wine for the box.");return}w(!0),y(null);try{let t="";if(v.length>0){let e=new FormData;v.forEach(t=>{e.append("files",t)});let r=await fetch("/api/upload",{method:"POST",body:e});if(!r.ok)throw Error("Failed to upload images");t=(await r.json()).files[0]||""}let s={...r,margin_percentage:parseFloat(r.margin_percentage),image_url:t||r.image_url};if(e){if(!(await fetch(`/api/admin/wine-boxes/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw Error("Failed to update wine box");if(!(await fetch(`/api/admin/wine-boxes/${e.id}/items`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({wineItems:h})})).ok)throw Error("Failed to update wine items")}else{let e=await fetch("/api/admin/wine-boxes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok)throw Error("Failed to create wine box");let t=await e.json();if(!(await fetch(`/api/admin/wine-boxes/${t.id}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({wineItems:h})})).ok)throw Error("Failed to add wine items")}N.push("/admin/wine-boxes"),N.refresh()}catch(e){console.error("Error saving wine box:",e),y("Failed to save wine box. Please try again.")}finally{w(!1)}};return(0,s.jsxs)("form",{onSubmit:k,className:"space-y-6",children:[j&&(0,s.jsx)(p.Fc,{variant:"destructive",children:(0,s.jsx)(p.TN,{children:j})}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsx)(c.ZB,{children:"Wine Box Information"}),(0,s.jsx)(c.BT,{children:"Basic information about the wine box"})]}),(0,s.jsxs)(c.Wu,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(l.J,{htmlFor:"name",children:"Name *"}),(0,s.jsx)(o.p,{id:"name",value:r.name,onChange:e=>_("name",e.target.value),required:!0,placeholder:"e.g., Organic Discovery Box"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.J,{htmlFor:"handle",children:"Handle *"}),(0,s.jsx)(o.p,{id:"handle",value:r.handle,onChange:e=>_("handle",e.target.value),required:!0,placeholder:"e.g., organic-discovery-box"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.J,{htmlFor:"description",children:"Description"}),(0,s.jsx)(d.T,{id:"description",value:r.description,onChange:e=>_("description",e.target.value),placeholder:"Describe the wine box...",rows:3})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(l.J,{htmlFor:"margin_percentage",children:"Margin Percentage (%)"}),(0,s.jsx)(o.p,{id:"margin_percentage",type:"number",step:"0.01",min:"0",max:"100",value:r.margin_percentage,onChange:e=>_("margin_percentage",e.target.value),placeholder:"15.00"})]})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.J,{children:"Wine Box Image"}),(0,s.jsx)(m.B,{images:v,onImagesChange:f})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"is_active",checked:r.is_active,onChange:e=>_("is_active",e.target.checked),className:"rounded"}),(0,s.jsx)(l.J,{htmlFor:"is_active",children:"Active"})]})]})]}),(0,s.jsxs)(c.Zp,{children:[(0,s.jsxs)(c.aR,{children:[(0,s.jsx)(c.ZB,{children:"Wine Selection"}),(0,s.jsx)(c.BT,{children:"Select wines to include in this box"})]}),(0,s.jsxs)(c.Wu,{children:[(0,s.jsx)(x.d,{selectedWines:h,onWinesChange:g}),h.length>0&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-gray-50 rounded-md",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Selected ",h.length," wine(s) with ",h.reduce((e,t)=>e+t.quantity,0)," total bottles"]})})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,s.jsx)(n.$,{type:"button",variant:"outline",onClick:()=>N.back(),children:"Cancel"}),(0,s.jsx)(n.$,{type:"submit",disabled:b||0===h.length,children:b?"Saving...":e?"Update Wine Box":"Create Wine Box"})]})]})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},16023:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(62688).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26240:(e,t,r)=>{"use strict";r.d(t,{B:()=>p});var s=r(60687),i=r(43210),a=r(24934),n=r(55192),o=r(3018),l=r(16023),d=r(13861),c=r(11860);function p({onImagesChange:e,images:t}){let[r,p]=(0,i.useState)(!1),[x,m]=(0,i.useState)(""),u=(0,i.useRef)(null),h=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?p(!0):"dragleave"===e.type&&p(!1)},g=r=>{e(t.filter((e,t)=>t!==r))},v=(r,s)=>{let i=[...t],[a]=i.splice(r,1);i.splice(s,0,a),e(i)};return(0,s.jsxs)(n.Zp,{children:[(0,s.jsxs)(n.aR,{children:[(0,s.jsx)(n.ZB,{children:"Product Images"}),(0,s.jsx)(n.BT,{children:"Upload multiple images for this product. Drag and drop to reorder."})]}),(0,s.jsxs)(n.Wu,{className:"space-y-4",children:[x&&(0,s.jsx)(o.Fc,{variant:"destructive",children:(0,s.jsx)(o.TN,{children:x})}),(0,s.jsxs)("div",{className:`border-2 border-dashed rounded-lg p-8 text-center transition-colors ${r?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400"}`,onDragEnter:h,onDragLeave:h,onDragOver:h,onDrop:r=>{r.preventDefault(),r.stopPropagation(),p(!1),m("");let s=Array.from(r.dataTransfer.files),i=s.filter(e=>e.type.startsWith("image/"));i.length!==s.length&&m("Some files are not images and were ignored"),i.length>0&&e([...t,...i])},children:[(0,s.jsx)(l.A,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,s.jsx)("p",{className:"text-lg font-medium text-gray-900 mb-2",children:"Drop images here or click to upload"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Supports JPG, PNG, GIF up to 10MB each"}),(0,s.jsx)(a.$,{onClick:()=>{u.current?.click()},variant:"outline",type:"button",children:"Choose Files"}),(0,s.jsx)("input",{ref:u,type:"file",multiple:!0,accept:"image/*",onChange:r=>{let s=Array.from(r.target.files||[]).filter(e=>e.type.startsWith("image/"));s.length>0&&e([...t,...s])},className:"hidden"})]}),t.length>0&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("h3",{className:"text-sm font-medium text-gray-900",children:["Uploaded Images (",t.length,")"]}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t.map((e,r)=>(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-lg border overflow-hidden bg-gray-100",children:(0,s.jsx)("img",{src:URL.createObjectURL(e),alt:`Product image ${r+1}`,className:"w-full h-full object-cover"})}),(0,s.jsxs)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center space-x-1",children:[(0,s.jsx)(a.$,{size:"sm",variant:"secondary",type:"button",className:"h-6 w-6 p-0",onClick:()=>{let t=window.open(URL.createObjectURL(e));t&&t.focus()},children:(0,s.jsx)(d.A,{className:"h-3 w-3"})}),(0,s.jsx)(a.$,{size:"sm",variant:"destructive",type:"button",className:"h-6 w-6 p-0",onClick:()=>g(r),children:(0,s.jsx)(c.A,{className:"h-3 w-3"})})]}),(0,s.jsxs)("div",{className:"absolute top-1 left-1 space-y-1",children:[r>0&&(0,s.jsx)(a.$,{size:"sm",variant:"secondary",className:"h-4 w-4 p-0 text-xs",type:"button",onClick:()=>v(r,r-1),children:"↑"}),r<t.length-1&&(0,s.jsx)(a.$,{size:"sm",variant:"secondary",className:"h-4 w-4 p-0 text-xs",type:"button",onClick:()=>v(r,r+1),children:"↓"})]}),(0,s.jsx)("div",{className:"absolute top-1 right-1 bg-black/70 text-white text-xs px-1 py-0.5 rounded text-[10px]",children:r+1})]},r))}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[(0,s.jsx)("p",{children:"• First image will be the main product image"}),(0,s.jsx)("p",{children:"• Drag and drop or use arrow buttons to reorder"}),(0,s.jsx)("p",{children:"• Click the eye icon to preview full size"})]})]})]})]})}},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31055:(e,t,r)=>{Promise.resolve().then(r.bind(r,4396)),Promise.resolve().then(r.bind(r,3213))},31727:(e,t,r)=>{"use strict";r.d(t,{DeleteWineBoxButton:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call DeleteWineBoxButton() from the server but DeleteWineBoxButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/axelsamuelson/Downloads/crowdvine_01/components/admin/delete-wine-box-button.tsx","DeleteWineBoxButton")},33873:e=>{"use strict";e.exports=require("path")},44779:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,pages:()=>c,routeModule:()=>x,tree:()=>d});var s=r(65239),i=r(48088),a=r(88170),n=r.n(a),o=r(30893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let d={children:["",{children:["admin",{children:["wine-boxes",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,70027)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/wine-boxes/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,42548)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[async e=>(await Promise.resolve().then(r.bind(r,90253))).default(e)],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,58014)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,52608)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/error.tsx"],"not-found":[()=>Promise.resolve().then(r.bind(r,82366)),"/Users/axelsamuelson/Downloads/crowdvine_01/app/not-found.tsx"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,46055))).default(e)],apple:[],openGraph:[async e=>(await Promise.resolve().then(r.bind(r,90253))).default(e)],twitter:[],manifest:void 0}}]}.children,c=["/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/wine-boxes/[id]/page.tsx"],p={require:r,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/admin/wine-boxes/[id]/page",pathname:"/admin/wine-boxes/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70027:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var s=r(37413),i=r(39916),a=r(31727),n=r(95313);async function o(e){let t=await fetch(`http://localhost:3000/api/admin/wine-boxes/${e}`,{cache:"no-store"});if(!t.ok)throw Error("Wine box not found");return t.json()}async function l(e){let t=await fetch(`http://localhost:3000/api/admin/wine-boxes/${e}/items`,{cache:"no-store"});return t.ok?t.json():[]}async function d({params:e}){try{let{id:t}=await e,[r,i]=await Promise.all([o(t),l(t)]);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Edit Wine Box"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Update wine box information"})]}),(0,s.jsx)(a.DeleteWineBoxButton,{wineBoxId:r.id,wineBoxName:r.name})]}),(0,s.jsx)(n.default,{wineBox:r,wineBoxItems:i})]})}catch(e){(0,i.notFound)()}}},74075:e=>{"use strict";e.exports=require("zlib")},77911:(e,t,r)=>{Promise.resolve().then(r.bind(r,95313)),Promise.resolve().then(r.bind(r,31727))},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},95313:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/wine-boxes/[id]/components/wine-box-form.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/axelsamuelson/Downloads/crowdvine_01/app/admin/wine-boxes/[id]/components/wine-box-form.tsx","default")}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4447,3008,4999,4386,8167,6355,8013,1410,5448,6679,5258,7498,9938],()=>r(44779));module.exports=s})();