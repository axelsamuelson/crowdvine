(()=>{var e={};e.id=4357,e.ids=[1268,4357],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9076:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>l,serverHooks:()=>m,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>u});var i={};r.r(i),r.d(i,{GET:()=>c});var a=r(96559),n=r(48088),o=r(37719),s=r(32190),d=r(11268);async function c(e,{params:t}){let i,a;let n=(0,d.getSupabaseAdmin)(),o=await t;if(o.handle.startsWith("wine-box-")){let e=o.handle.replace("wine-box-","");try{let{getAllWineBoxCalculations:t}=await Promise.all([r.e(4999),r.e(4386),r.e(3152)]).then(r.bind(r,33152)),i=(await t()).find(t=>t.wineBoxId===e);if(!i)return s.NextResponse.json({error:"not_found"},{status:404});let a={id:i.wineBoxId,title:i.name,description:i.description,descriptionHtml:`<p>${i.description}</p>`,handle:`wine-box-${i.wineBoxId}`,productType:"wine-box",categoryId:"wine-boxes-collection",priceRange:{minVariantPrice:{amount:i.finalPrice.toFixed(2),currencyCode:"SEK"},maxVariantPrice:{amount:i.finalPrice.toFixed(2),currencyCode:"SEK"}},featuredImage:{id:`${i.wineBoxId}-img`,url:i.imageUrl||"https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=600&h=600&fit=crop",altText:i.name,width:600,height:600},images:[{id:`${i.wineBoxId}-img`,url:i.imageUrl||"https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=600&h=600&fit=crop",altText:i.name,width:600,height:600}],variants:[{id:`${i.wineBoxId}-variant`,title:`${i.bottleCount} Bottles`,availableForSale:!0,price:{amount:i.finalPrice.toFixed(2),currencyCode:"SEK"},selectedOptions:[{name:"Size",value:`${i.bottleCount} Bottles`},{name:"Discount",value:`${Math.round(i.discountPercentage)}% off`}]}],options:[{id:"size",name:"Size",values:[{id:`${i.bottleCount}-bottles`,name:`${i.bottleCount} Bottles`}]},{id:"discount",name:"Discount",values:[{id:`${Math.round(i.discountPercentage)}-discount`,name:`${Math.round(i.discountPercentage)}% off`}]}],tags:[`${i.bottleCount}-bottles`,`${i.discountPercentage}-discount`],seo:{title:i.name,description:i.description},availableForSale:!0,currencyCode:"SEK",updatedAt:new Date().toISOString(),createdAt:new Date().toISOString(),discountInfo:{totalWinePrice:i.totalWinePrice,discountAmount:i.discountAmount,discountPercentage:i.discountPercentage,finalPrice:i.finalPrice,wines:i.wines}};return s.NextResponse.json(a)}catch(e){return console.error("Error fetching wine box:",e),s.NextResponse.json({error:"Failed to fetch wine box"},{status:500})}}let{data:c,error:l}=await n.from("wines").select("id").eq("handle",o.handle).single();if(l||!c)return s.NextResponse.json({error:"not_found"},{status:404});try{let e=await n.from("wines").select(`
        id,
        wine_name,
        vintage,
        grape_varieties,
        color,
        handle,
        base_price_cents,
        label_image_path,
        producer_id,
        description,
        description_html,
        producers!inner(name)
      `).eq("id",c.id).single();i=e.data,a=e.error}catch(e){return console.error("Error fetching wine:",e),s.NextResponse.json({error:"Failed to fetch wine"},{status:500})}if(a||!i)return s.NextResponse.json({error:"not_found"},{status:404});let{data:p}=await n.from("wine_images").select("image_path, alt_text, sort_order, is_primary").eq("wine_id",c.id).order("sort_order",{ascending:!0}),u=i,m=Array.isArray(u.grape_varieties)?u.grape_varieties:u.grape_varieties?u.grape_varieties.split(",").map(e=>e.trim()):[],h=u.color,g=p&&p.length>0?p.map(e=>({id:`${u.id}-img-${e.sort_order}`,url:e.image_path,altText:e.alt_text||u.wine_name,width:600,height:600})):[{id:`${u.id}-img`,url:u.label_image_path||"https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=600&h=600&fit=crop",altText:u.wine_name,width:600,height:600}],w=g[0]||{id:`${u.id}-img`,url:u.label_image_path||"https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=600&h=600&fit=crop",altText:u.wine_name,width:600,height:600},x=u.description||`This exceptional ${u.color||"wine"} wine from ${u.vintage} showcases the unique characteristics of ${u.grape_varieties||"carefully selected grapes"}. Crafted with precision and passion, this wine offers a perfect balance of flavors and aromas that will delight your palate.`,f=u.description_html||`<p>${x}</p>`,_={id:u.id,title:`${u.wine_name} ${u.vintage}`,description:x,descriptionHtml:f,handle:u.handle,productType:"wine",categoryId:u.producer_id,producerName:u.producers?.name||"Unknown Producer",options:[{id:"grape-varieties",name:"Grape Varieties",values:m.map(e=>({id:e.toLowerCase().replace(/\s+/g,"-"),name:e}))},{id:"color",name:"Color",values:h?[{id:h.toLowerCase().replace(/\s+/g,"-"),name:h}]:[]}],variants:[{id:`${u.id}-default`,title:"750 ml",availableForSale:!0,price:{amount:Math.ceil(u.base_price_cents/100).toString(),currencyCode:"SEK"},selectedOptions:[...m.map(e=>({name:"Grape Varieties",value:e})),...h?[{name:"Color",value:h}]:[]]}],priceRange:{minVariantPrice:{amount:Math.ceil(u.base_price_cents/100).toString(),currencyCode:"SEK"},maxVariantPrice:{amount:Math.ceil(u.base_price_cents/100).toString(),currencyCode:"SEK"}},featuredImage:w,images:g,seo:{title:u.wine_name,description:m.join(", ")||""},tags:[...m,...h?[h]:[]],availableForSale:!0,currencyCode:"SEK",updatedAt:new Date().toISOString(),createdAt:new Date().toISOString()};return s.NextResponse.json(_)}let l=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/crowdvine/products/[handle]/route",pathname:"/api/crowdvine/products/[handle]",filename:"route",bundlePath:"app/api/crowdvine/products/[handle]/route"},resolvedPagePath:"/Users/axelsamuelson/Downloads/crowdvine_01/app/api/crowdvine/products/[handle]/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:p,workUnitAsyncStorage:u,serverHooks:m}=l;function h(){return(0,o.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:u})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11268:(e,t,r)=>{"use strict";r.d(t,{getSupabaseAdmin:()=>a});var i=r(83008);function a(){let e="https://abrnvjqwpdkodgrtezeg.supabase.co",t=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!t)throw Error("Missing Supabase admin credentials");return(0,i.UU)(e,t)}},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[4447,3008,580],()=>r(9076));module.exports=i})();