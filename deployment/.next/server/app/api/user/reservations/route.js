(()=>{var e={};e.id=8751,e.ids=[1268,8751],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7094:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>c,serverHooks:()=>_,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{GET:()=>u});var i=t(96559),a=t(48088),n=t(37719),o=t(32190),d=t(11268);async function u(){try{let e=(0,d.getSupabaseAdmin)(),r="7122d74d-f06c-4b25-be10-0fe025607981";console.log(`Fetching reservations for user: ${r}`);let{data:t,error:s}=await e.from("order_reservations").select("*").eq("user_id",r).order("created_at",{ascending:!1});if(s)return console.error("Error fetching reservations:",s),o.NextResponse.json({error:"Failed to fetch reservations"},{status:500});if(console.log(`Found ${t?.length||0} reservations for user ${r}`),!t||0===t.length)return o.NextResponse.json([]);let i=await Promise.all(t.map(async r=>{let t="Unassigned Pallet",s=null;if(r.pickup_zone_id&&r.delivery_zone_id){let{data:i}=await e.from("pallets").select("id, name").eq("pickup_zone_id",r.pickup_zone_id).eq("delivery_zone_id",r.delivery_zone_id).single();i&&(t=i.name,s=i.id)}let i="No delivery address";if(r.address_id){let{data:t}=await e.from("user_addresses").select("address_street, address_city, address_postcode, country_code").eq("id",r.address_id).single();t&&(i=`${t.address_street}, ${t.address_postcode} ${t.address_city}, ${t.country_code}`)}let{data:a}=await e.from("order_reservation_items").select(`
          item_id,
          quantity,
          wines(
            wine_name,
            vintage,
            label_image_path,
            grape_varieties,
            color,
            base_price_cents
          )
        `).eq("reservation_id",r.id),n=a?.map(e=>({wine_name:e.wines?.wine_name||"Unknown Wine",quantity:e.quantity,vintage:e.wines?.vintage||"N/A",image_path:e.wines?.label_image_path||null,grape_varieties:e.wines?.grape_varieties||null,color:e.wines?.color||null,price_per_bottle_cents:e.wines?.base_price_cents||0,total_cost_cents:(e.wines?.base_price_cents||0)*e.quantity}))||[],o=n.reduce((e,r)=>e+r.total_cost_cents,0);return{id:r.id,order_id:r.order_id||r.id,status:r.status,created_at:r.created_at,pallet_id:s,pallet_name:t,delivery_address:i,total_cost_cents:o,items:n}}));return o.NextResponse.json(i)}catch(e){return console.error("Reservations API error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/user/reservations/route",pathname:"/api/user/reservations",filename:"route",bundlePath:"app/api/user/reservations/route"},resolvedPagePath:"/Users/axelsamuelson/Downloads/crowdvine_01/app/api/user/reservations/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:p,workUnitAsyncStorage:l,serverHooks:_}=c;function v(){return(0,n.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:l})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11268:(e,r,t)=>{"use strict";t.d(r,{getSupabaseAdmin:()=>i});var s=t(83008);function i(){let e="https://abrnvjqwpdkodgrtezeg.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!r)throw Error("Missing Supabase admin credentials");return(0,s.UU)(e,r)}},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},78335:()=>{},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[4447,3008,580],()=>t(7094));module.exports=s})();